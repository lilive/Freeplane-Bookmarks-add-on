<map version="freeplane 1.7.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="Bookmarks" LOCALIZED_STYLE_REF="styles.topic" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1562500393682" LINK="https://github.com/lilive/Freeplane-Bookmarks-add-on" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#000000" STYLE="rectangle" SHAPE_HORIZONTAL_MARGIN="6.0 pt" SHAPE_VERTICAL_MARGIN="6.0 pt">
<edge WIDTH="thin"/>
<hook NAME="MapStyle" background="#c4c4c4">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" show_notes_in_map="false" edgeColorConfiguration="#353535ff,#353535ff,#353535ff,#353535ff,#353535ff" MarksKeys="{&quot;108&quot;:&quot;ID_303460997&quot;,&quot;99&quot;:&quot;ID_1257390437&quot;,&quot;111&quot;:&quot;ID_185824507&quot;}" Marks_stored_node_id="ID_1837714869"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="14.0 pt" MAX_WIDTH="600.0 px" COLOR="#000000" BACKGROUND_COLOR="#dddad7" BACKGROUND_ALPHA="0" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" BORDER_WIDTH="0.0 px" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#808080" BORDER_COLOR_ALPHA="0">
<font NAME="Candara" SIZE="14"/>
<edge STYLE="horizontal" COLOR="#818181" WIDTH="thin"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details"/>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes">
<font SIZE="9"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note"/>
<stylenode LOCALIZED_TEXT="defaultstyle.floating">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="styles.topic" STYLE="oval" SHAPE_HORIZONTAL_MARGIN="6.0 pt" SHAPE_VERTICAL_MARGIN="6.0 pt" UNIFORM_SHAPE="true" BORDER_WIDTH="4.0 px" BORDER_DASH="DASHES">
<font NAME="Raleway" SIZE="14" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important">
<icon BUILTIN="yes"/>
</stylenode>
<stylenode TEXT="Ligne 1" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#808080">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#ff4a4a" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 2" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#ffc265">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#ffa14a" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 3" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#feff62">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#fff24a" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 4" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#7dff72">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#69ff4a" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 5" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#61fff2">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#4affe4" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 6" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#6973ff">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#6973ff" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Ligne 7" BACKGROUND_COLOR="#cccccc" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="600.0 px" BORDER_WIDTH="3.0 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#ff6df2">
<font NAME="Raleway" SIZE="14"/>
<edge COLOR="#ff4af8" WIDTH="3"/>
</stylenode>
<stylenode TEXT="Code" BACKGROUND_COLOR="#ffffff" BACKGROUND_ALPHA="58" STYLE="rectangle" SHAPE_HORIZONTAL_MARGIN="4.0 pt" MAX_WIDTH="2000.0 px">
<font NAME="Source Code Pro" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000">
<font SIZE="18"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff">
<font SIZE="16"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#00b439">
<font SIZE="14"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000">
<font SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111">
<font SIZE="10"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="117" RULE="ON_BRANCH_CREATION"/>
<attribute_layout NAME_WIDTH="92.9999972283841 pt" VALUE_WIDTH="197.24999412149208 pt"/>
<attribute NAME="name" VALUE="bookmarks"/>
<attribute NAME="version" VALUE="v0.5.1"/>
<attribute NAME="author" VALUE="lilive"/>
<attribute NAME="freeplaneVersionFrom" VALUE="1.7.5"/>
<attribute NAME="freeplaneVersionTo" VALUE=""/>
<attribute NAME="updateUrl" VALUE=""/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      The homepage of this add-on should be set as the link of the root node.
    </p>
    <p>
      The basic properties of this add-on. They can be used in script names and other attributes, e.g. &quot;${name}.groovy&quot;.
    </p>
    <ul>
      <li>
        name: The name of the add-on, normally a technically one (no spaces, no special characters except _.-).
      </li>
      <li>
        author: Author's name(s) and (optionally) email adresses.
      </li>
      <li>
        version: Since it's difficult to protect numbers like 1.0 from Freeplane's number parser it's advised to prepend a 'v' to the number, e.g. 'v1.0'.
      </li>
      <li>
        freeplane-version-from: The oldest compatible Freeplane version. The add-on will not be installed if the Freeplane version is too old.
      </li>
      <li>
        freeplane-version-to: Normally empty: The newest compatible Freeplane version. The add-on will not be installed if the Freeplane version is too new.
      </li>
      <li>
        updateUrl: URL of the file containing information (version, download url) on the latest version of this add-on. By default: &quot;${homepage}/version.properties&quot;
      </li>
    </ul>
  </body>
</html>
</richcontent>
<node TEXT="description" POSITION="left" ID="ID_1114811084" CREATED="1562410359487" MODIFIED="1562499736245" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Description would be awkward to edit as an attribute.
    </p>
    <p>
      So you have to put the add-on description as a child of the <i>'description'</i>&#160;node.
    </p>
    <p>
      To translate the description you have to define a translation for the key 'addons.${name}.description'.
    </p>
  </body>
</html>
</richcontent>
<node TEXT="Add bookmarks to nodes, and easily navigate beetween them." ID="ID_1183587619" CREATED="1518707454288" MODIFIED="1518815727777"/>
</node>
<node TEXT="changes" POSITION="left" ID="ID_1094494132" CREATED="1562410359592" MODIFIED="1562499736248" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Change log of this add-on: append one node for each noteworthy version and put the details for each version into a child node.
    </p>
  </body>
</html>
</richcontent>
<node TEXT="v0.3" ID="ID_1947541306" CREATED="1518881580800" MODIFIED="1518881585971">
<node TEXT="First released version" ID="ID_1150257103" CREATED="1518881587391" MODIFIED="1518881596914"/>
</node>
<node TEXT="v0.4" ID="ID_1236674265" CREATED="1518881417536" MODIFIED="1518881420019">
<node TEXT="Clean the map storage each time ToggleBookmarkSelectionView is used (to avoid increasing size of the file)" ID="ID_955061404" CREATED="1518881423311" MODIFIED="1518881534034"/>
</node>
<node TEXT="v0.4.1" ID="ID_1277201401" CREATED="1518881390240" MODIFIED="1518881395099">
<node TEXT="The bookmark icon is now SVG" ID="ID_1361390652" CREATED="1518881396976" MODIFIED="1518881414405"/>
</node>
<node TEXT="v0.4.2" ID="ID_490789856" CREATED="1518883033697" MODIFIED="1518883037789">
<node TEXT="Sources files cleanup" ID="ID_655524488" CREATED="1518883038976" MODIFIED="1518883131764"/>
</node>
<node TEXT="v0.5.0" ID="ID_116400648" CREATED="1562409091573" MODIFIED="1562409097366">
<node TEXT="Complete rewrite of the add-on. Introduce named bookmarks." ID="ID_419235170" CREATED="1562409104741" MODIFIED="1562417968655"/>
</node>
<node TEXT="v0.5.1" ID="ID_540433193" CREATED="1562499877679" MODIFIED="1562499881604">
<node TEXT="Rename bookmarks icons" ID="ID_27269396" CREATED="1562499884480" MODIFIED="1562499895702"/>
</node>
</node>
<node TEXT="license" FOLDED="true" POSITION="left" ID="ID_230785910" CREATED="1562410359599" MODIFIED="1562499736251" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      The add-ons's license that the user has to accept before she can install it.
    </p>
    <p>
      
    </p>
    <p>
      The License text has to be entered as a child of the <i>'license'</i>&#160;node, either as plain text or as HTML.
    </p>
  </body>
</html>
</richcontent>
<node TEXT="&#xa;This add-on is free software: you can redistribute it and/or modify&#xa;it under the terms of the GNU General Public License as published by&#xa;the Free Software Foundation, either version 2 of the License, or&#xa;(at your option) any later version.&#xa;&#xa;This program is distributed in the hope that it will be useful,&#xa;but WITHOUT ANY WARRANTY; without even the implied warranty of&#xa;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&#xa;GNU General Public License for more details.&#xa;" ID="ID_1167386088" CREATED="1562410359607" MODIFIED="1562410359614"/>
</node>
<node TEXT="preferences.xml" POSITION="left" ID="ID_1098616655" CREATED="1562410359628" MODIFIED="1562499736256" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#000000" face="SansSerif, sans-serif">The child node contains the add-on configuration as an extension to mindmapmodemenu.xml (in Tools-&gt;Preferences-&gt;Add-ons). </font>
    </p>
    <p>
      <font color="#000000" face="SansSerif, sans-serif">Every property in the configuration should receive a default value in <i>default.properties</i>&#160;node.</font>
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="default.properties" POSITION="left" ID="ID_151630546" CREATED="1562410359652" MODIFIED="1562499736259" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      These properties are used for:
    </p>
    <ul>
      <li>
        Each property defined in the preferences should have a default value in the attributes of this node.
      </li>
      <li>
        For each menu item with an icon add an attribute with the icon key (use developer tool menuItemInfo) as key and the icon path as value. Example: '${name}.icon': '/images/${name}-icon.png'
      </li>
    </ul>
  </body>
</html>
</richcontent>
</node>
<node TEXT="translations" POSITION="left" ID="ID_255907585" CREATED="1562410359658" MODIFIED="1562499736262" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      The translation keys that this script uses. Define one child node per supported locale. The attributes contain the translations. Define at least
    </p>
    <ul>
      <li>
        'addons.${name}' for the add-on's name
      </li>
      <li>
        'addons.${name}.description' for the description, e.g. in the add-on overview dialog (not necessary for English)
      </li>
      <li>
        'addons.${name}.&lt;scriptname&gt;' for each script since it will be the menu title.
      </li>
    </ul>
  </body>
</html>
</richcontent>
<node TEXT="en" ID="ID_737947027" CREATED="1562410359665" MODIFIED="1562437580849">
<attribute_layout NAME_WIDTH="170.999994903803 pt" VALUE_WIDTH="320.9999904334548 pt"/>
<attribute NAME="addons.${name}" VALUE="Bookmarks"/>
<attribute NAME="addons.${name}.BookmarkNode" VALUE="Add / Remove a bookmark"/>
<attribute NAME="addons.${name}.JumpToBookmark" VALUE="Jump to bookmark"/>
<attribute NAME="addons.${name}.ToggleBookmark" VALUE="Toggle the bookmark"/>
<attribute NAME="addons.${name}.CreateLinkInBookmark" VALUE="Create link in bookmarked node"/>
<attribute NAME="addons.${name}.CreateLinkToBookmark" VALUE="Create link to bookmarked node"/>
</node>
<node TEXT="fr" ID="ID_1748679509" CREATED="1562410359665" MODIFIED="1562437585762">
<attribute_layout NAME_WIDTH="170.24999492615476 pt" VALUE_WIDTH="320.9999904334548 pt"/>
<attribute NAME="addons.${name}" VALUE="Marque-pages"/>
<attribute NAME="addons.${name}.BookmarkNode" VALUE="Placer/Supprimer un marque-page"/>
<attribute NAME="addons.${name}.JumpToBookmark" VALUE="Atteindre un marque_page"/>
<attribute NAME="addons.${name}.ToggleBookmark" VALUE="Basculer un marque-page"/>
<attribute NAME="addons.${name}.CreateLinkInBookmark" VALUE="Cr\u00E9er un lien dans un marque-page"/>
<attribute NAME="addons.${name}.CreateLinkToBookmark" VALUE="Cr\u00E9er un lien vers un marque-page"/>
</node>
</node>
<node TEXT="deinstall" POSITION="left" ID="ID_1870605844" CREATED="1562410359689" MODIFIED="1562499790576">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      List of files and/or directories to remove on uninstall
    </p>
  </body>
</html>
</richcontent>
<attribute_layout VALUE_WIDTH="389.9999883770946 pt"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}.script.xml"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/BookmarkNode.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/CreateLinkToCurrentNodeInMarkedNode.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/CreateLinkToMarkInCurrentNode.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/JumpToBookmark.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/ToggleBookmark.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/scripts/init/BookmarksMonitorIcons.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/CreateLinkInBookmark.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/CreateLinkToBookmark.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/lib/Bookmarks.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/addons/${name}/scripts/Common.groovy"/>
<attribute NAME="delete" VALUE="${installationbase}/icons/bookmarks/Bookmark 1.svg"/>
<attribute NAME="delete" VALUE="${installationbase}/icons/bookmarks/Bookmark 2.svg"/>
</node>
<node TEXT="scripts" POSITION="right" ID="ID_1460492722" CREATED="1562410359701" MODIFIED="1562499736279" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      An add-on may contain multiple scripts. The node text defines the script name (e.g. insertInlineImage.groovy). The name must have a suffix of a supported script language like .groovy or .js and may only consist of letters and digits. The script properties have to be configured via attributes:
    </p>
    <p>
      
    </p>
    <p>
      * menuLocation: &lt;locationkey&gt;
    </p>
    <p>
      &#160;&#160;&#160;- Defines the menu location, defaults a sub menu 'main_menu_scripting/addons.${name}'.
    </p>
    <p>
      &#160;&#160;&#160;-&#160;Use developer tool menuItemInfo to inspect menu location keys.
    </p>
    <p>
      &#160;&#160;&#160;- This attribute is mandatory
    </p>
    <p>
      
    </p>
    <p>
      * menuTitleKey: &lt;key&gt;
    </p>
    <p>
      &#160;&#160;&#160;- The menu item title will be looked up under the translation key &lt;key&gt; - don't forget to define its translation.
    </p>
    <p>
      &#160;&#160;&#160;- This attribute is mandatory
    </p>
    <p>
      
    </p>
    <p>
      * executionMode: &lt;mode&gt;
    </p>
    <p>
      &#160;&#160;&#160;- The execution mode as described in the Freeplane wiki (http://freeplane.sourceforge.net/wiki/index.php/Scripting)
    </p>
    <p>
      &#160;&#160;&#160;- ON_SINGLE_NODE: Execute the script once. The <i>node</i>&#160;variable is set to the selected node.
    </p>
    <p>
      &#160;&#160;&#160;- ON_SELECTED_NODE: Execute the script n times for n selected nodes, once for each node.
    </p>
    <p>
      &#160;&#160;&#160;- ON_SELECTED_NODE_RECURSIVELY: Execute the script on every selected node and recursively on all of its children.
    </p>
    <p>
      &#160;&#160;&#160;- In doubt use ON_SINGLE_NODE.
    </p>
    <p>
      &#160;&#160;&#160;- This attribute is mandatory
    </p>
    <p>
      
    </p>
    <p>
      * keyboardShortcut: &lt;shortcut&gt;
    </p>
    <p>
      &#160;&#160;&#160;- Optional: keyboard combination / accelerator for this script, e.g. control alt I
    </p>
    <p>
      &#160;&#160;&#160;- Use lowercase letters for modifiers and uppercase for letters. Use no + signs.
    </p>
    <p>
      &#160;&#160;&#160;- The available key names are listed at http://download.oracle.com/javase/1.4.2/docs/api/java/awt/event/KeyEvent.html#VK_0
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;In the list only entries with a 'VK_' prefix count. Omit the prefix in the shortcut definition.
    </p>
    <p>
      
    </p>
    <p>
      * Permissions&#160;that the script(s) require, each either false or true:
    </p>
    <p>
      &#160;&#160;&#160;- execute_scripts_without_asking
    </p>
    <p>
      &#160;&#160;&#160;- execute_scripts_without_file_restriction: permission to read files
    </p>
    <p>
      &#160;&#160;&#160;- execute_scripts_without_write_restriction: permission to create/change/delete files
    </p>
    <p>
      &#160;&#160;&#160;- execute_scripts_without_exec_restriction: permission to execute other programs
    </p>
    <p>
      &#160;&#160;&#160;- execute_scripts_without_network_restriction: permission to access the network
    </p>
    <p>
      &#160;&#160;Notes:
    </p>
    <p>
      &#160;&#160;- The set of permissions is fixed.
    </p>
    <p>
      &#160;&#160;- Don't change the attribute names, don't omit one.
    </p>
    <p>
      &#160;&#160;- Set the values either to true or to false
    </p>
    <p>
      &#160;&#160;- In any case set execute_scripts_without_asking to true unless you want to annoy users.
    </p>
  </body>
</html>
</richcontent>
<node TEXT="BookmarkNode.groovy" FOLDED="true" ID="ID_1722187040" CREATED="1562410359729" MODIFIED="1562412132309">
<attribute_layout NAME_WIDTH="172.49999485909953 pt" VALUE_WIDTH="213.7499936297538 pt"/>
<attribute NAME="menuTitleKey" VALUE="addons.${name}.BookmarkNode"/>
<attribute NAME="menuLocation" VALUE="/menu_bar/${name}"/>
<attribute NAME="executionMode" VALUE="on_single_node"/>
<attribute NAME="keyboardShortcut" VALUE=""/>
<attribute NAME="execute_scripts_without_asking" VALUE="true"/>
<attribute NAME="execute_scripts_without_file_restriction" VALUE="true"/>
<attribute NAME="execute_scripts_without_write_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_exec_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_network_restriction" VALUE="false"/>
<node TEXT="import org.freeplane.plugin.script.proxy.Convertible&#xd;&#xa;import groovy.json.JsonBuilder&#xd;&#xa;import groovy.json.JsonSlurper&#xd;&#xa;import groovy.swing.SwingBuilder&#xd;&#xa;import javax.swing.JFrame&#xd;&#xa;import javax.swing.BoxLayout&#xd;&#xa;import java.awt.event.*&#xd;&#xa;import java.awt.Color&#xd;&#xa;import java.awt.Component&#xd;&#xa;import java.awt.BorderLayout&#xd;&#xa;&#xd;&#xa;storageKey = &quot;BookmarksKeys&quot;&#xd;&#xa;anonymousIcon = &quot;bookmarks/Bookmark 1&quot;&#xd;&#xa;namedIcon = &quot;bookmarks/Bookmark 2&quot;&#xd;&#xa;&#xd;&#xa;def Map loadNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap where :&#xd;&#xa;    // - the keys are the keyboard keys assigned to a bookmarked node;&#xd;&#xa;    // - the values are the id of the corresponding bookmarked node.&#xd;&#xa;    // This HashMap is read from the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    // Read the datas from the map storage&#xd;&#xa;    def marksString = new Convertible( &apos;{}&apos; )&#xd;&#xa;    def stored = node.map.storage.getAt( storageKey )&#xd;&#xa;    if( stored ) marksString = stored;&#xd;&#xa;&#xd;&#xa;    // Convert these datas to an HashMap&#xd;&#xa;    def namedBookmarks = new JsonSlurper().parseText( marksString.getText() )&#xd;&#xa;&#xd;&#xa;    return namedBookmarks as Map&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def saveNamedBookmarks( namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Store the HashMap namedBookmarks in the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    def builder = new JsonBuilder()&#xd;&#xa;    builder( namedBookmarks )&#xd;&#xa;    node.map.storage.putAt( storageKey, builder.toString() )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def createNamedBookmark( node, keyCharCode, namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Create a named bookmark for this node. The name of the&#xd;&#xa;    // bookmark is a single keyboard key.&#xd;&#xa;&#xd;&#xa;    String s = String.valueOf( keyCharCode )&#xd;&#xa;&#xd;&#xa;    // If another node has this named bookmark, remove it&#xd;&#xa;    if( namedBookmarks.containsKey( s ) )&#xd;&#xa;    {&#xd;&#xa;        def n = map.node( namedBookmarks[ s ] )&#xd;&#xa;        if( n &amp;&amp; n != node ) deleteNamedBookmark( n, namedBookmarks )&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    // Delete the existing named bookmarks assigned to the current node&#xd;&#xa;    namedBookmarks.removeAll{ k, v -&gt; v == node.id }&#xd;&#xa;&#xd;&#xa;    // Assign the key pressed to the current node&#xd;&#xa;    namedBookmarks[ s ] = node.id&#xd;&#xa;&#xd;&#xa;    // Save the new namedBookmarks map&#xd;&#xa;    saveNamedBookmarks( namedBookmarks )&#xd;&#xa;&#xd;&#xa;    // Add the icon&#xd;&#xa;    node.icons.add( namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def deleteNamedBookmark( node, namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Delete an existing named bookmark&#xd;&#xa;&#xd;&#xa;    if( namedBookmarks.containsValue( node.id ) )&#xd;&#xa;        {&#xd;&#xa;        // Clear the map&#xd;&#xa;        namedBookmarks.removeAll{ key, value -&gt; value == node.id }&#xd;&#xa;&#xd;&#xa;        // Save the new namedBookmarks map&#xd;&#xa;        saveNamedBookmarks( namedBookmarks )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Remove the icon&#xd;&#xa;    node.icons.remove( namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def createAnonymousBookmark( node )&#xd;&#xa;{&#xd;&#xa;    // Create an anonymous bookmark for this node.&#xd;&#xa;    node.icons.add( anonymousIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def deleteAnonymousBookmark( node )&#xd;&#xa;{&#xd;&#xa;    node.icons.remove( anonymousIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;&#xd;&#xa;namedBookmarks = loadNamedBookmarks()&#xd;&#xa;&#xd;&#xa;// Make sure namedBookmarks is up-to-date&#xd;&#xa;def change = false&#xd;&#xa;namedBookmarks.removeAll&#xd;&#xa;{&#xd;&#xa;    // Remove from the map all the node that don&apos;t exist&#xd;&#xa;    // and add icon for each bookmarked node&#xd;&#xa;    key, id -&gt;&#xd;&#xa;    def n = map.node( id )&#xd;&#xa;    def missing = n == null&#xd;&#xa;    if( ! missing )&#xd;&#xa;&#x9;{&#xd;&#xa;&#x9;if( ! n.icons.contains( namedIcon ) ) n.icons.add( namedIcon )&#xd;&#xa;    } else {&#xd;&#xa;        change = true&#xd;&#xa;    }&#xd;&#xa;    missing&#xd;&#xa;}&#xd;&#xa;if( change ) saveNamedBookmarks( namedBookmarks )&#xd;&#xa;&#xd;&#xa;isAnonymousBookmark = node.icons.contains( anonymousIcon )&#xd;&#xa;isNamedBookmark = namedBookmarks.containsValue( node.id )&#xd;&#xa;&#xd;&#xa;// Create the graphical user interface to display&#xd;&#xa;def gui&#xd;&#xa;groovy.swing.SwingBuilder.build&#xd;&#xa;{&#xd;&#xa;    gui = dialog(&#xd;&#xa;        title: &apos;Bookmarks&apos;,&#xd;&#xa;        modal: true,&#xd;&#xa;        owner: ui.frame,&#xd;&#xa;        defaultCloseOperation: JFrame.DISPOSE_ON_CLOSE,&#xd;&#xa;        pack: true&#xd;&#xa;    ){&#xd;&#xa;        borderLayout()&#xd;&#xa;        def blue = new Color( 0, 0, 255 )&#xd;&#xa;&#xd;&#xa;        // Fist panel : instructions&#xd;&#xa;        panel(&#xd;&#xa;            border: emptyBorder( 10 ),&#xd;&#xa;            constraints: BorderLayout.PAGE_START,&#xd;&#xa;        ){&#xd;&#xa;            boxLayout(axis: BoxLayout.Y_AXIS )&#xd;&#xa;            if( isAnonymousBookmark )&#xd;&#xa;            {&#xd;&#xa;                label(&#xd;&#xa;                    text: &quot;This node is already bookmarked.&quot;,&#xd;&#xa;                    foreground: blue,&#xd;&#xa;                    border: emptyBorder( 0, 0, 5, 0 )&#xd;&#xa;                )&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Backspace&lt;/b&gt; : Delete this bookmark&lt;/html&gt;&quot;)&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Other key&lt;/b&gt; : Create instead a named bookmark&lt;/html&gt;&quot;)&#xd;&#xa;            }&#xd;&#xa;            else if( isNamedBookmark )&#xd;&#xa;            {&#xd;&#xa;                label(&#xd;&#xa;                    text: &quot;This node already has a named bookmark.&quot;,&#xd;&#xa;                    foreground: blue,&#xd;&#xa;                    border: emptyBorder( 0, 0, 5, 0 )&#xd;&#xa;                )&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Backspace&lt;/b&gt; : Delete this bookmark&lt;/html&gt;&quot;)&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Space&lt;/b&gt; : Create instead a regular bookmark&lt;/html&gt;&quot;)&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Other key&lt;/b&gt; : Change the name of this bookmark&quot;)&#xd;&#xa;            }&#xd;&#xa;            else&#xd;&#xa;            {&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Space&lt;/b&gt; : Create a regular bookmark&lt;/html&gt;&quot;)&#xd;&#xa;                label(&quot;&lt;html&gt;&lt;b&gt;Other key&lt;/b&gt; : Create a named bookmark&lt;/html&gt;&quot;)&#xd;&#xa;            }&#xd;&#xa;            label(&quot;&lt;html&gt;&lt;b&gt;Esc&lt;/b&gt; to cancel&lt;/html&gt;&quot;)&#xd;&#xa;        }&#xd;&#xa;&#xd;&#xa;        // Second panel : only if named bookmarks exists&#xd;&#xa;        if( namedBookmarks.size() &gt; 0 )&#xd;&#xa;        {&#xd;&#xa;            panel(&#xd;&#xa;                border:titledBorder( &quot;Already named bookmarks are&quot; ),&#xd;&#xa;                constraints: BorderLayout.CENTER&#xd;&#xa;            ){&#xd;&#xa;                boxLayout( axis: BoxLayout.Y_AXIS )&#xd;&#xa;                namedBookmarks.each&#xd;&#xa;                {&#xd;&#xa;                    key, id -&gt;&#xd;&#xa;                    // Display a line of text with the associated key&#xd;&#xa;                    // and the 30 first caracters of the node&#xd;&#xa;                    def target = map.node( id )&#xd;&#xa;                    def text = target.text&#xd;&#xa;                    if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;                    text =&#xd;&#xa;                        &quot;&lt;html&gt;&lt;font color=&apos;red&apos;&gt;&lt;b&gt;&quot; +&#xd;&#xa;                        String.valueOf( (char) Integer.parseInt( key ) ) +&#xd;&#xa;                        &quot;&lt;/b&gt;&lt;/font&gt; : &quot; +&#xd;&#xa;                        text +&#xd;&#xa;                        &quot;&lt;/html&gt;&quot;&#xd;&#xa;                    if( id == node.id ) label( text: text, foreground: blue )&#xd;&#xa;                    else label( text )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the response to the user key press&#xd;&#xa;gui.setFocusable(true)&#xd;&#xa;gui.addKeyListener(&#xd;&#xa;    new java.awt.event.KeyAdapter()&#xd;&#xa;    {&#xd;&#xa;        @Override&#xd;&#xa;        public void keyTyped(KeyEvent e)&#xd;&#xa;        {&#xd;&#xa;            // Get the key pressed&#xd;&#xa;            char chr = e.getKeyChar()&#xd;&#xa;            int keyCharCode = (int) chr&#xd;&#xa;&#xd;&#xa;            if( keyCharCode == 8 )&#xd;&#xa;            {&#xd;&#xa;                if( isNamedBookmark )&#xd;&#xa;                {&#xd;&#xa;                    deleteNamedBookmark( node, namedBookmarks )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                    c.statusInfo = &apos;This node has no bookmark anymore&apos;&#xd;&#xa;                }&#xd;&#xa;                else if( isAnonymousBookmark )&#xd;&#xa;                {&#xd;&#xa;                    deleteAnonymousBookmark( node )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                    c.statusInfo = &apos;This node has no bookmark anymore&apos;&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;            else if( keyCharCode == 32 )&#xd;&#xa;            {&#xd;&#xa;                if( isNamedBookmark )&#xd;&#xa;                {&#xd;&#xa;                    deleteNamedBookmark( node, namedBookmarks )&#xd;&#xa;                    createAnonymousBookmark( node )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                    c.statusInfo = &apos;This node now has a regular bookmark&apos;&#xd;&#xa;                }&#xd;&#xa;                else if( ! isAnonymousBookmark )&#xd;&#xa;                {&#xd;&#xa;                    createAnonymousBookmark( node )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                    c.statusInfo = &apos;This node now has a regular bookmark&apos;&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;            else if( keyCharCode &gt; 32 &amp;&amp; keyCharCode != 127 &amp;&amp; keyCharCode &lt; 256 )&#xd;&#xa;            {&#xd;&#xa;                if( isAnonymousBookmark ) deleteAnonymousBookmark( node )&#xd;&#xa;                createNamedBookmark( node, keyCharCode, namedBookmarks )&#xd;&#xa;                gui.dispose()&#xd;&#xa;                c.statusInfo = &apos;This node now has a bookmark named &quot;&apos; + chr + &quot;&apos;&quot;&#xd;&#xa;            }&#xd;&#xa;            else if( keyCharCode == 27 )&#xd;&#xa;            {&#xd;&#xa;                c.statusInfo = &apos;Bookmark operation aborded&apos;&#xd;&#xa;                gui.dispose()&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;)&#xd;&#xa;&#xd;&#xa;// Center the gui over the freeplane window&#xd;&#xa;gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;gui.visible = true&#xd;&#xa;&#xd;&#xa;" ID="ID_1354550020" CREATED="1562509032537" MODIFIED="1562509032583"/>
</node>
<node TEXT="JumpToBookmark.groovy" FOLDED="true" ID="ID_1077199462" CREATED="1562410359734" MODIFIED="1562412168184">
<attribute_layout NAME_WIDTH="181.49999459087866 pt" VALUE_WIDTH="230.24999313801547 pt"/>
<attribute NAME="menuTitleKey" VALUE="addons.${name}.JumpToBookmark"/>
<attribute NAME="menuLocation" VALUE="/menu_bar/${name}"/>
<attribute NAME="executionMode" VALUE="on_single_node"/>
<attribute NAME="keyboardShortcut" VALUE=""/>
<attribute NAME="execute_scripts_without_asking" VALUE="true"/>
<attribute NAME="execute_scripts_without_file_restriction" VALUE="true"/>
<attribute NAME="execute_scripts_without_write_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_exec_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_network_restriction" VALUE="false"/>
<node TEXT="import groovy.json.JsonBuilder&#xd;&#xa;import groovy.json.JsonSlurper&#xd;&#xa;import groovy.swing.SwingBuilder&#xd;&#xa;import java.awt.BorderLayout&#xd;&#xa;import java.awt.Color&#xd;&#xa;import java.awt.Component&#xd;&#xa;import java.awt.FlowLayout&#xd;&#xa;import java.awt.GridBagConstraints&#xd;&#xa;import java.awt.Image&#xd;&#xa;import java.awt.KeyboardFocusManager&#xd;&#xa;import java.awt.event.*&#xd;&#xa;import javax.swing.AbstractAction&#xd;&#xa;import javax.swing.ActionMap&#xd;&#xa;import javax.swing.BoxLayout&#xd;&#xa;import javax.swing.ImageIcon&#xd;&#xa;import javax.swing.InputMap&#xd;&#xa;import javax.swing.JComponent&#xd;&#xa;import javax.swing.JFrame&#xd;&#xa;import javax.swing.JList&#xd;&#xa;import javax.swing.JPanel&#xd;&#xa;import javax.swing.KeyStroke&#xd;&#xa;import javax.swing.SwingConstants&#xd;&#xa;import javax.swing.UIManager&#xd;&#xa;import org.freeplane.plugin.script.proxy.Convertible&#xd;&#xa;&#xd;&#xa;storageKey = &quot;BookmarksKeys&quot;&#xd;&#xa;anonymousIcon = &quot;bookmarks/Bookmark 1&quot;&#xd;&#xa;namedIcon = &quot;bookmarks/Bookmark 2&quot;&#xd;&#xa;map = node.map&#xd;&#xa;namedBookmarks = []&#xd;&#xa;anonymousBookmarks = []&#xd;&#xa;&#xd;&#xa;gui = null&#xd;&#xa;&#xd;&#xa;def Map loadNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap where :&#xd;&#xa;    // - the keys are the keyboard keys assigned to a bookmarked node;&#xd;&#xa;    // - the values are the id of the corresponding bookmarked node.&#xd;&#xa;    // This HashMap is read from the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    // Read the datas from the map storage&#xd;&#xa;    def marksString = new Convertible( &apos;{}&apos; )&#xd;&#xa;    def stored = node.map.storage.getAt( storageKey )&#xd;&#xa;    if( stored ) marksString = stored;&#xd;&#xa;&#xd;&#xa;    // Convert these datas to an HashMap&#xd;&#xa;    def namedBookmarksMap = new JsonSlurper().parseText( marksString.getText() )&#xd;&#xa;&#xd;&#xa;    return namedBookmarksMap as Map&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def saveNamedBookmarks( Map namedBookmarksMap )&#xd;&#xa;{&#xd;&#xa;    // Store the HashMap namedBookmarks in the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    def builder = new JsonBuilder()&#xd;&#xa;    builder( namedBookmarksMap )&#xd;&#xa;    node.map.storage.putAt( storageKey, builder.toString() )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def populateAnonymousBookmarksList( node, List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( node.icons.contains( anonymousIcon ) ){&#xd;&#xa;        def text = node.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        bookmarks &lt;&lt; [ &quot;id&quot;: node.id, &quot;text&quot;: text ]&#xd;&#xa;    }&#xd;&#xa;    node.children.each{ populateAnonymousBookmarksList( it, bookmarks ) }&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def putIconAtFirstPosition( node, icon )&#xd;&#xa;{&#xd;&#xa;    // Add an icon at the first position for this node&#xd;&#xa;    // Ensure this icon is unique&#xd;&#xa;&#xd;&#xa;    def icons = node.icons&#xd;&#xa;    &#xd;&#xa;    // Do nothing else if there is already this icon as fisrt icon&#xd;&#xa;    def num = icons.iterator().count( icon )&#xd;&#xa;    if( num == 1 &amp;&amp; icons.first == icon ) return&#xd;&#xa;&#xd;&#xa;    def oldIcons = icons.iterator().toList()&#xd;&#xa;&#xd;&#xa;    // Remove all the same icons if necessary&#xd;&#xa;    if( num &gt; 0 ) oldIcons.removeAll{ it == icon }&#xd;&#xa;&#xd;&#xa;    def newIcons = [ icon ]&#xd;&#xa;    newIcons.addAll( oldIcons )&#xd;&#xa;    icons.clear()&#xd;&#xa;    icons.addAll( newIcons )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def addNamedBookmarkIcon( node )&#xd;&#xa;{&#xd;&#xa;    // Add the named bookmark icon to this node, if needed.&#xd;&#xa;    // Remove anonymous bookmarks icons.&#xd;&#xa;    // Ensure the icon is the first icon of the node&#xd;&#xa;&#xd;&#xa;    def icons = node.getIcons()&#xd;&#xa;&#xd;&#xa;    // Remove anonymous bookmarks icons&#xd;&#xa;    while( icons.contains( anonymousIcon ) ) icons.remove( anonymousIcon )&#xd;&#xa;&#xd;&#xa;    putIconAtFirstPosition( node, namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Jump to a node after the gui close&#xd;&#xa;def jumpToNodeAfterGuiDispose( target, message )&#xd;&#xa;{&#xd;&#xa;    // If the code to jump to a node is executed before the gui close,&#xd;&#xa;    // it leave freeplane in a bad focus state.&#xd;&#xa;    // This is solved by putting this code in a listener executed&#xd;&#xa;    // after the gui destruction:&#xd;&#xa;    gui.addWindowListener(&#xd;&#xa;        new WindowAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override&#xd;&#xa;            public void windowClosed( WindowEvent event )&#xd;&#xa;            {&#xd;&#xa;                c.select(  target )&#xd;&#xa;                c.centerOnNode( target )&#xd;&#xa;                c.statusInfo = message&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the named bookmarks&#xd;&#xa;def List initNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap for the named bookmarks&#xd;&#xa;    def bmksMap = loadNamedBookmarks()&#xd;&#xa;&#xd;&#xa;    // Make sure namedBookmarks is up-to-date&#xd;&#xa;    def change = false&#xd;&#xa;    bmksMap.removeAll&#xd;&#xa;    {&#xd;&#xa;        // Remove from the map all the node that don&apos;t exist&#xd;&#xa;        // and add icon for each bookmarked node&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def n = map.node( id )&#xd;&#xa;        def missing = n == null&#xd;&#xa;        if( ! missing ) addNamedBookmarkIcon( n )&#xd;&#xa;        else {&#xd;&#xa;            change = true&#xd;&#xa;        }&#xd;&#xa;        missing&#xd;&#xa;    }&#xd;&#xa;    if( change ) saveNamedBookmarks( bmksMap )&#xd;&#xa;&#xd;&#xa;    // Refactor the map to make a list, better suited for the rest of the script&#xd;&#xa;    def bmksList = bmksMap.collect{&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def target = map.node( id )&#xd;&#xa;        def text = target.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        [&#xd;&#xa;            &quot;id&quot;: id,&#xd;&#xa;            &quot;name&quot;: String.valueOf( (char) Integer.parseInt( key ) ),&#xd;&#xa;            &quot;text&quot;: text&#xd;&#xa;        ]&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return bmksList&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the anonymous bookmarks&#xd;&#xa;def List initAnonymousBookmarks()&#xd;&#xa;{&#xd;&#xa;    def bookmarks = []&#xd;&#xa;    populateAnonymousBookmarksList( map.root, bookmarks )&#xd;&#xa;    return bookmarks&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getNamedBookmarksJList(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    String currentNodeId&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{&#xd;&#xa;                // Display for each bookmark the name of the bookmark,&#xd;&#xa;                // followed by the text of the node&#xd;&#xa;                if( it.id != currentNodeId ) &quot;&lt;html&gt;&lt;font color=&apos;red&apos;&gt;&lt;b&gt;&lt;i&gt;$it.name&lt;/i&gt;&lt;/b&gt;&lt;/font&gt; : $it.text&lt;/html&gt;&quot;&#xd;&#xa;                else &quot;&lt;html&gt;&lt;font color=&apos;red&apos;&gt;&lt;b&gt;&lt;i&gt;$it.name&lt;/i&gt;&lt;/b&gt;&lt;/font&gt;&lt;b&gt; : $it.text&lt;/b&gt;&lt;/html&gt;&quot;&#xd;&#xa;            },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() ),&#xd;&#xa;            border: emptyBorder( 5 )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Initialize the component state&#xd;&#xa;    int selectedIdx = bookmarks.findIndexOf{ it.id == currentNodeId }&#xd;&#xa;    if( selectedIdx &lt; 0 ) selectedIdx = 0;&#xd;&#xa;    component.setSelectedIndex( selectedIdx )&#xd;&#xa;    component.ensureIndexIsVisible( selectedIdx )&#xd;&#xa;    &#xd;&#xa;    // Set the user interactions&#xd;&#xa;    &#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            public void keyReleased( KeyEvent e )&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                char chr = e.getKeyChar()&#xd;&#xa;                int idx = (int) chr&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int i = component.getSelectedIndex()&#xd;&#xa;                    if( i &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ i ]&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        jumpToNodeAfterGuiDispose( target, &quot;Jumped to bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;                else if( idx &gt; 32 &amp;&amp; idx != 127 &amp;&amp; idx &lt; 256 ){&#xd;&#xa;                    // Try to jump to the corresponding node id&#xd;&#xa;                    String s = String.valueOf( chr )&#xd;&#xa;                    def bm = bookmarks.find{ it.name == s }&#xd;&#xa;                    if( bm )&#xd;&#xa;                        {&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        jumpToNodeAfterGuiDispose( target, &quot;Jumped to bookmark named \&quot;${s}\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        c.statusInfo = &apos;There is no node marked with the key &apos; + chr&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    jumpToNodeAfterGuiDispose( target, &quot;Jump to bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the named bookmarks&#xd;&#xa;def JPanel getNamedBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;&#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the named bookmark you want to jump to.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To jump to a named bookmark either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Press one of the red keys&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To jump to a standard bookmark press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getAnonymousBookmarksJList(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    String currentNodeId&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{&#xd;&#xa;                if( currentNodeId == it.id ) &quot;&lt;html&gt;&lt;b&gt;$it.text&lt;/b&gt;&lt;/html&gt;&quot;&#xd;&#xa;                else it.text&#xd;&#xa;            },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Initialize the component state&#xd;&#xa;    int selectedIdx = bookmarks.findIndexOf{ it.id == currentNodeId }&#xd;&#xa;    if( selectedIdx &lt; 0 ) selectedIdx = 0&#xd;&#xa;    component.setSelectedIndex( selectedIdx )&#xd;&#xa;    component.ensureIndexIsVisible( selectedIdx )&#xd;&#xa;&#xd;&#xa;    // Set the user interactions&#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void keyReleased(KeyEvent e)&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int idx = component.getSelectedIndex()&#xd;&#xa;                    if( idx &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ idx ]&#xd;&#xa;                        def target = node.map.node( bm.id )&#xd;&#xa;                        jumpToNodeAfterGuiDispose( target, &quot;Jump to bookmark&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;        &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    jumpToNodeAfterGuiDispose( target, &quot;Jump to bookmark&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the anonymous bookmarks&#xd;&#xa;def JPanel getAnonymousBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;            &#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the bookmark you want to jump to.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To jump to a bookmark either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To jump to a named bookmark press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the graphical user interface to display&#xd;&#xa;def createGui(&#xd;&#xa;    JPanel namedPanel, JList namedJList,&#xd;&#xa;    JPanel anonymPanel, JList anonymJList&#xd;&#xa;)&#xd;&#xa;{&#xd;&#xa;    def gui&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        gui = dialog(&#xd;&#xa;            title: &apos;Jump to bookmark&apos;,&#xd;&#xa;            modal:true,&#xd;&#xa;            owner: ui.frame,&#xd;&#xa;            defaultCloseOperation: JFrame.DISPOSE_ON_CLOSE&#xd;&#xa;        ){&#xd;&#xa;            borderLayout()&#xd;&#xa;            // A panel for all the compontents (needed to add an inner padding)&#xd;&#xa;            panel(&#xd;&#xa;                border: emptyBorder( 10 ),&#xd;&#xa;                constraints: BorderLayout.PAGE_START&#xd;&#xa;            ){&#xd;&#xa;                borderLayout()&#xd;&#xa;&#xd;&#xa;                // First element of the main panel :&#xd;&#xa;                // A panel which can contains 2 panels:&#xd;&#xa;                // - one for the named bookmarks&#xd;&#xa;                // - one for the anonymous bookmarks&#xd;&#xa;                panel( constraints: BorderLayout.LINE_START )&#xd;&#xa;                {&#xd;&#xa;                    borderLayout()&#xd;&#xa;                    if( namedPanel ) widget( namedPanel, constraints: BorderLayout.PAGE_START )&#xd;&#xa;                    if( anonymPanel ) widget( anonymPanel, constraints: BorderLayout.PAGE_END )&#xd;&#xa;                }&#xd;&#xa;&#xd;&#xa;                // Second element of the main panel :&#xd;&#xa;                label( text: &quot;&lt;html&gt;Press &lt;i&gt;Esc&lt;/i&gt; to cancel&lt;/html&gt;.&quot;, constraints: BorderLayout.PAGE_END )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Set est Esc ket to close the script&#xd;&#xa;    def onEscPressID = &quot;onEscPress&quot;&#xd;&#xa;    def inputMap = gui.getRootPane().getInputMap( JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT )&#xd;&#xa;    inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_ESCAPE, 0 ), onEscPressID )&#xd;&#xa;    gui.getRootPane().getActionMap().put(&#xd;&#xa;        onEscPressID,&#xd;&#xa;        new AbstractAction()&#xd;&#xa;        {&#xd;&#xa;&#x9;    @Override&#xd;&#xa;&#x9;    public void actionPerformed( ActionEvent e )&#xd;&#xa;            {&#xd;&#xa;&#x9;        gui.dispose()&#xd;&#xa;                c.statusInfo = &apos;Jump to bookmark aborded&apos;&#xd;&#xa;&#x9;    }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    if( namedJList )&#xd;&#xa;        {&#xd;&#xa;        if( anonymPanel ) anonymPanel.visible = false&#xd;&#xa;        namedJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    else if( anonymJList )&#xd;&#xa;        {&#xd;&#xa;        if( namedPanel ) namedPanel.visible = false&#xd;&#xa;        anonymJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    // Set the Tab key to switch between the 2 bookmarks types&#xd;&#xa;    if( namedPanel &amp;&amp; namedJList &amp;&amp; anonymPanel &amp;&amp; anonymJList )&#xd;&#xa;        {&#xd;&#xa;        namedJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        anonymJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        def onTabPressID = &quot;onTabPress&quot;&#xd;&#xa;        inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_TAB, 0 ), onTabPressID )&#xd;&#xa;        gui.getRootPane().getActionMap().put(&#xd;&#xa;            onTabPressID,&#xd;&#xa;            new AbstractAction()&#xd;&#xa;            {&#xd;&#xa;                public void actionPerformed( ActionEvent e )&#xd;&#xa;                {&#xd;&#xa;                    if( namedPanel.visible )&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = false&#xd;&#xa;                        anonymPanel.visible = true&#xd;&#xa;                        anonymJList.requestFocus()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = true&#xd;&#xa;                        anonymPanel.visible = false&#xd;&#xa;                        namedJList.requestFocus()&#xd;&#xa;                    }                &#xd;&#xa;                    gui.pack()&#xd;&#xa;                    gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return gui&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Find all the bookmarks&#xd;&#xa;namedBookmarks = initNamedBookmarks()&#xd;&#xa;anonymousBookmarks = initAnonymousBookmarks()&#xd;&#xa;&#xd;&#xa;// Detect if the current node has a named bookmark&#xd;&#xa;isNamedBookmark = namedBookmarks.any{ it[ &quot;id&quot; ] == node.id }&#xd;&#xa;// Detect if the current node has a anonymous bookmark&#xd;&#xa;isAnonymousBookmark = node.icons.contains( anonymousIcon )&#xd;&#xa;&#xd;&#xa;// Quit the script if there is no bookmarks&#xd;&#xa;if( ! namedBookmarks &amp;&amp; ! anonymousBookmarks )&#xd;&#xa;    {&#xd;&#xa;    ui.informationMessage( ui.frame, &quot;There is no bookmarks !&quot;, &quot;Bookmarks&quot; )&#xd;&#xa;    return&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the gui&#xd;&#xa;JList namedBookmarksJList = getNamedBookmarksJList( namedBookmarks, node.id )&#xd;&#xa;JPanel namedBookmarksJPanel = getNamedBookmarksJPanel(&#xd;&#xa;    namedBookmarks, namedBookmarksJList, (boolean)anonymousBookmarks&#xd;&#xa;)&#xd;&#xa;JList anonymousBookmarksJList = getAnonymousBookmarksJList( anonymousBookmarks, node.id )&#xd;&#xa;JPanel anonymousBookmarksJPanel = getAnonymousBookmarksJPanel(&#xd;&#xa;    anonymousBookmarks, anonymousBookmarksJList, (boolean)namedBookmarks&#xd;&#xa;)&#xd;&#xa;gui = createGui(&#xd;&#xa;    namedBookmarksJPanel, namedBookmarksJList,&#xd;&#xa;    anonymousBookmarksJPanel, anonymousBookmarksJList&#xd;&#xa;)&#xd;&#xa;&#xd;&#xa;// Center the gui over the freeplane window&#xd;&#xa;gui.pack()&#xd;&#xa;gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;gui.visible = true&#xd;&#xa;&#xd;&#xa;" ID="ID_1574228914" CREATED="1562509032594" MODIFIED="1562509032596"/>
</node>
<node TEXT="ToggleBookmark.groovy" FOLDED="true" ID="ID_656120992" CREATED="1562410359736" MODIFIED="1562412173032">
<attribute_layout NAME_WIDTH="180.7499946132304 pt" VALUE_WIDTH="231.74999309331199 pt"/>
<attribute NAME="menuTitleKey" VALUE="addons.${name}.ToggleBookmark"/>
<attribute NAME="menuLocation" VALUE="/menu_bar/${name}"/>
<attribute NAME="executionMode" VALUE="on_single_node"/>
<attribute NAME="keyboardShortcut" VALUE=""/>
<attribute NAME="execute_scripts_without_asking" VALUE="true"/>
<attribute NAME="execute_scripts_without_file_restriction" VALUE="true"/>
<attribute NAME="execute_scripts_without_write_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_exec_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_network_restriction" VALUE="false"/>
<node TEXT="import org.freeplane.plugin.script.proxy.Convertible&#xd;&#xa;import groovy.json.JsonBuilder&#xd;&#xa;import groovy.json.JsonSlurper&#xd;&#xa;&#xd;&#xa;storageKey = &quot;BookmarksKeys&quot;&#xd;&#xa;anonymousIcon = &quot;bookmarks/Bookmark 1&quot;&#xd;&#xa;namedIcon = &quot;bookmarks/Bookmark 2&quot;&#xd;&#xa;&#xd;&#xa;def Map loadNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap where :&#xd;&#xa;    // - the keys are the keyboard keys assigned to a bookmarked node;&#xd;&#xa;    // - the values are the id of the corresponding bookmarked node.&#xd;&#xa;    // This HashMap is read from the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    // Read the datas from the map storage&#xd;&#xa;    def marksString = new Convertible( &apos;{}&apos; )&#xd;&#xa;    def stored = node.map.storage.getAt( storageKey )&#xd;&#xa;    if( stored ) marksString = stored;&#xd;&#xa;&#xd;&#xa;    // Convert these datas to an HashMap&#xd;&#xa;    def namedBookmarks = new JsonSlurper().parseText( marksString.getText() )&#xd;&#xa;&#xd;&#xa;    return namedBookmarks as Map&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def saveNamedBookmarks( namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Store the HashMap namedBookmarks in the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    def builder = new JsonBuilder()&#xd;&#xa;    builder( namedBookmarks )&#xd;&#xa;    node.map.storage.putAt( storageKey, builder.toString() )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def createNamedBookmark( node, keyCharCode, namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Create a named bookmark for this node. The name of the&#xd;&#xa;    // bookmark is a single keyboard key.&#xd;&#xa;&#xd;&#xa;    String s = String.valueOf( keyCharCode )&#xd;&#xa;&#xd;&#xa;    // If another node has this named bookmark, remove it&#xd;&#xa;    if( namedBookmarks.containsKey( s ) )&#xd;&#xa;    {&#xd;&#xa;        def n = map.node( namedBookmarks[ s ] )&#xd;&#xa;        if( n &amp;&amp; n != node ) deleteNamedBookmark( n, namedBookmarks )&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    // Delete the existing named bookmarks assigned to the current node&#xd;&#xa;    namedBookmarks.removeAll{ k, v -&gt; v == node.id }&#xd;&#xa;&#xd;&#xa;    // Assign the key pressed to the current node&#xd;&#xa;    namedBookmarks[ s ] = node.id&#xd;&#xa;&#xd;&#xa;    // Save the new namedBookmarks map&#xd;&#xa;    saveNamedBookmarks( namedBookmarks )&#xd;&#xa;&#xd;&#xa;    // Add the icon&#xd;&#xa;    node.icons.add( namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def deleteNamedBookmark( node, namedBookmarks )&#xd;&#xa;{&#xd;&#xa;    // Delete an existing named bookmark&#xd;&#xa;&#xd;&#xa;    if( namedBookmarks.containsValue( node.id ) )&#xd;&#xa;        {&#xd;&#xa;        // Clear the map&#xd;&#xa;        namedBookmarks.removeAll{ key, value -&gt; value == node.id }&#xd;&#xa;&#xd;&#xa;        // Save the new namedBookmarks map&#xd;&#xa;        saveNamedBookmarks( namedBookmarks )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Remove the icon&#xd;&#xa;    node.icons.remove( namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def createAnonymousBookmark( node )&#xd;&#xa;{&#xd;&#xa;    // Create an anonymous bookmark for this node.&#xd;&#xa;    node.icons.add( anonymousIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def deleteAnonymousBookmark( node )&#xd;&#xa;{&#xd;&#xa;    node.icons.remove( anonymousIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;&#xd;&#xa;namedBookmarks = loadNamedBookmarks()&#xd;&#xa;&#xd;&#xa;// Make sure namedBookmarks is up-to-date&#xd;&#xa;def change = false&#xd;&#xa;namedBookmarks.removeAll&#xd;&#xa;{&#xd;&#xa;    // Remove from the map all the node that don&apos;t exist&#xd;&#xa;    // and add icon for each bookmarked node&#xd;&#xa;    key, id -&gt;&#xd;&#xa;    def n = map.node( id )&#xd;&#xa;    def missing = n == null&#xd;&#xa;    if( ! missing )&#xd;&#xa;&#x9;{&#xd;&#xa;&#x9;if( ! n.icons.contains( namedIcon ) ) n.icons.add( namedIcon )&#xd;&#xa;    } else {&#xd;&#xa;        change = true&#xd;&#xa;    }&#xd;&#xa;    missing&#xd;&#xa;}&#xd;&#xa;if( change ) saveNamedBookmarks( namedBookmarks )&#xd;&#xa;&#xd;&#xa;isAnonymousBookmark = node.icons.contains( anonymousIcon )&#xd;&#xa;isNamedBookmark = namedBookmarks.containsValue( node.id )&#xd;&#xa;&#xd;&#xa;if( isNamedBookmark )&#xd;&#xa;{&#xd;&#xa;    // Remove the named bookmark and put a regular bookmark instead&#xd;&#xa;    deleteNamedBookmark( node, namedBookmarks )&#xd;&#xa;    createAnonymousBookmark( node )&#xd;&#xa;    c.statusInfo = &apos;This node now has a regular bookmark&apos;&#xd;&#xa;}&#xd;&#xa;else if( isAnonymousBookmark )&#xd;&#xa;    {&#xd;&#xa;    // Remove the named bookmark&#xd;&#xa;    deleteAnonymousBookmark( node )&#xd;&#xa;    c.statusInfo = &apos;This node has no bookmark anymore&apos;&#xd;&#xa;}&#xd;&#xa;else&#xd;&#xa;    {&#xd;&#xa;    // Create a regular bookmark&#xd;&#xa;    createAnonymousBookmark( node )&#xd;&#xa;    c.statusInfo = &apos;This node now has a regular bookmark&apos;&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;" ID="ID_1678890801" CREATED="1562509032597" MODIFIED="1562509032598"/>
</node>
<node TEXT="CreateLinkInBookmark.groovy" FOLDED="true" ID="ID_331545763" CREATED="1562412710758" MODIFIED="1562413602937">
<attribute_layout NAME_WIDTH="182.24999456852692 pt" VALUE_WIDTH="241.49999280273937 pt"/>
<attribute NAME="menuTitleKey" VALUE="addons.${name}.CreateLinkInBookmark"/>
<attribute NAME="menuLocation" VALUE="/menu_bar/${name}"/>
<attribute NAME="executionMode" VALUE="on_single_node"/>
<attribute NAME="keyboardShortcut" VALUE=""/>
<attribute NAME="execute_scripts_without_asking" VALUE="true"/>
<attribute NAME="execute_scripts_without_file_restriction" VALUE="true"/>
<attribute NAME="execute_scripts_without_write_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_exec_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_network_restriction" VALUE="false"/>
<node TEXT="import groovy.json.JsonBuilder&#xd;&#xa;import groovy.json.JsonSlurper&#xd;&#xa;import groovy.swing.SwingBuilder&#xd;&#xa;import java.awt.BorderLayout&#xd;&#xa;import java.awt.Color&#xd;&#xa;import java.awt.Component&#xd;&#xa;import java.awt.FlowLayout&#xd;&#xa;import java.awt.GridBagConstraints&#xd;&#xa;import java.awt.Image&#xd;&#xa;import java.awt.KeyboardFocusManager&#xd;&#xa;import java.awt.event.*&#xd;&#xa;import javax.swing.AbstractAction&#xd;&#xa;import javax.swing.ActionMap&#xd;&#xa;import javax.swing.BoxLayout&#xd;&#xa;import javax.swing.ImageIcon&#xd;&#xa;import javax.swing.InputMap&#xd;&#xa;import javax.swing.JComponent&#xd;&#xa;import javax.swing.JFrame&#xd;&#xa;import javax.swing.JList&#xd;&#xa;import javax.swing.JPanel&#xd;&#xa;import javax.swing.KeyStroke&#xd;&#xa;import javax.swing.SwingConstants&#xd;&#xa;import javax.swing.UIManager&#xd;&#xa;import org.freeplane.plugin.script.proxy.Convertible&#xd;&#xa;import org.freeplane.features.link.LinkController&#xd;&#xa;import org.freeplane.features.link.mindmapmode.MLinkController&#xd;&#xa;&#xd;&#xa;storageKey = &quot;BookmarksKeys&quot;&#xd;&#xa;anonymousIcon = &quot;bookmarks/Bookmark 1&quot;&#xd;&#xa;namedIcon = &quot;bookmarks/Bookmark 2&quot;&#xd;&#xa;map = node.map&#xd;&#xa;namedBookmarks = []&#xd;&#xa;anonymousBookmarks = []&#xd;&#xa;&#xd;&#xa;gui = null&#xd;&#xa;&#xd;&#xa;def Map loadNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap where :&#xd;&#xa;    // - the keys are the keyboard keys assigned to a bookmarked node;&#xd;&#xa;    // - the values are the id of the corresponding bookmarked node.&#xd;&#xa;    // This HashMap is read from the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    // Read the datas from the map storage&#xd;&#xa;    def marksString = new Convertible( &apos;{}&apos; )&#xd;&#xa;    def stored = node.map.storage.getAt( storageKey )&#xd;&#xa;    if( stored ) marksString = stored;&#xd;&#xa;&#xd;&#xa;    // Convert these datas to an HashMap&#xd;&#xa;    def namedBookmarksMap = new JsonSlurper().parseText( marksString.getText() )&#xd;&#xa;&#xd;&#xa;    return namedBookmarksMap as Map&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def saveNamedBookmarks( Map namedBookmarksMap )&#xd;&#xa;{&#xd;&#xa;    // Store the HashMap namedBookmarks in the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    def builder = new JsonBuilder()&#xd;&#xa;    builder( namedBookmarksMap )&#xd;&#xa;    node.map.storage.putAt( storageKey, builder.toString() )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def populateAnonymousBookmarksList( node, List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( node.icons.contains( anonymousIcon ) ){&#xd;&#xa;        def text = node.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        bookmarks &lt;&lt; [ &quot;id&quot;: node.id, &quot;text&quot;: text ]&#xd;&#xa;    }&#xd;&#xa;    node.children.each{ populateAnonymousBookmarksList( it, bookmarks ) }&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def putIconAtFirstPosition( node, icon )&#xd;&#xa;{&#xd;&#xa;    // Add an icon at the first position for this node&#xd;&#xa;    // Ensure this icon is unique&#xd;&#xa;&#xd;&#xa;    def icons = node.icons&#xd;&#xa;    &#xd;&#xa;    // Do nothing else if there is already this icon as fisrt icon&#xd;&#xa;    def num = icons.iterator().count( icon )&#xd;&#xa;    if( num == 1 &amp;&amp; icons.first == icon ) return&#xd;&#xa;&#xd;&#xa;    def oldIcons = icons.iterator().toList()&#xd;&#xa;&#xd;&#xa;    // Remove all the same icons if necessary&#xd;&#xa;    if( num &gt; 0 ) oldIcons.removeAll{ it == icon }&#xd;&#xa;&#xd;&#xa;    def newIcons = [ icon ]&#xd;&#xa;    newIcons.addAll( oldIcons )&#xd;&#xa;    icons.clear()&#xd;&#xa;    icons.addAll( newIcons )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def addNamedBookmarkIcon( node )&#xd;&#xa;{&#xd;&#xa;    // Add the named bookmark icon to this node, if needed.&#xd;&#xa;    // Remove anonymous bookmarks icons.&#xd;&#xa;    // Ensure the icon is the first icon of the node&#xd;&#xa;&#xd;&#xa;    def icons = node.getIcons()&#xd;&#xa;&#xd;&#xa;    // Remove anonymous bookmarks icons&#xd;&#xa;    while( icons.contains( anonymousIcon ) ) icons.remove( anonymousIcon )&#xd;&#xa;&#xd;&#xa;    putIconAtFirstPosition( node, namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a link to another node in a node&#xd;&#xa;def createLink( src, dst, message )&#xd;&#xa;{&#xd;&#xa;    dst.link.node = src&#xd;&#xa;    c.statusInfo = message&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the named bookmarks, except the current node if it is one of them&#xd;&#xa;def List initNamedBookmarks( currentNodeId )&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap for the named bookmarks&#xd;&#xa;    def bmksMap = loadNamedBookmarks()&#xd;&#xa;&#xd;&#xa;    // Make sure namedBookmarks is up-to-date&#xd;&#xa;    def change = false&#xd;&#xa;    bmksMap.removeAll&#xd;&#xa;    {&#xd;&#xa;        // Remove from the map all the node that don&apos;t exist&#xd;&#xa;        // and add icon for each bookmarked node&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def n = map.node( id )&#xd;&#xa;        def missing = n == null&#xd;&#xa;        if( ! missing ) addNamedBookmarkIcon( n )&#xd;&#xa;        else {&#xd;&#xa;            change = true&#xd;&#xa;        }&#xd;&#xa;        missing&#xd;&#xa;    }&#xd;&#xa;    if( change ) saveNamedBookmarks( bmksMap )&#xd;&#xa;&#xd;&#xa;    // If the currentNode is a named bookmark, remove it&#xd;&#xa;    bmksMap.removeAll{ key, id -&gt; id == currentNodeId }&#xd;&#xa;    &#xd;&#xa;    // Refactor the map to make a list, better suited for the rest of the script&#xd;&#xa;    def bmksList = bmksMap.collect{&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def target = map.node( id )&#xd;&#xa;        def text = target.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        [&#xd;&#xa;            &quot;id&quot;: id,&#xd;&#xa;            &quot;name&quot;: String.valueOf( (char) Integer.parseInt( key ) ),&#xd;&#xa;            &quot;text&quot;: text&#xd;&#xa;        ]&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return bmksList&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the anonymous bookmarks, except from the current node if it is one of them&#xd;&#xa;def List initAnonymousBookmarks( currentNodeId )&#xd;&#xa;{&#xd;&#xa;    def bookmarks = []&#xd;&#xa;    populateAnonymousBookmarksList( map.root, bookmarks )&#xd;&#xa;    // Remove the currentNode&#xd;&#xa;    bookmarks.removeAll{ it.id == currentNodeId }&#xd;&#xa;    return bookmarks&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getNamedBookmarksJList( List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{&#xd;&#xa;                // Display for each bookmark the name of the bookmark,&#xd;&#xa;                // followed by the text of the node&#xd;&#xa;                &quot;&lt;html&gt;&lt;font color=&apos;red&apos;&gt;&lt;b&gt;&lt;i&gt;$it.name&lt;/i&gt;&lt;/b&gt;&lt;/font&gt; : $it.text&lt;/html&gt;&quot;&#xd;&#xa;            },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() ),&#xd;&#xa;            border: emptyBorder( 5 )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;    component.setSelectedIndex( 0 )&#xd;&#xa;    &#xd;&#xa;    // Set the user interactions&#xd;&#xa;    &#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            public void keyReleased( KeyEvent e )&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                char chr = e.getKeyChar()&#xd;&#xa;                int idx = (int) chr&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int i = component.getSelectedIndex()&#xd;&#xa;                    if( i &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ i ]&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link in bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;                else if( idx &gt; 32 &amp;&amp; idx != 127 &amp;&amp; idx &lt; 256 ){&#xd;&#xa;                    // Try to link to the corresponding node id&#xd;&#xa;                    String s = String.valueOf( chr )&#xd;&#xa;                    def bm = bookmarks.find{ it.name == s }&#xd;&#xa;                    if( bm )&#xd;&#xa;                        {&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link in bookmark named \&quot;${s}\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        c.statusInfo = &apos;There is no node marked with the key &apos; + chr&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    createLink( node, target, &quot;Created link in bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the named bookmarks&#xd;&#xa;def JPanel getNamedBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;&#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the named bookmark you want to link to this node.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To create a link to this node in a named bookmarked node either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Press one of the red keys&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To create a link in a standard bookmarked node press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getAnonymousBookmarksJList( List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{ it.text },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;    component.setSelectedIndex( 0 )&#xd;&#xa;&#xd;&#xa;    // Set the user interactions&#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void keyReleased(KeyEvent e)&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int idx = component.getSelectedIndex()&#xd;&#xa;                    if( idx &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ idx ]&#xd;&#xa;                        def target = node.map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link in bookmark&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;        &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    createLink( node, target, &quot;Created link in bookmark&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the anonymous bookmarks&#xd;&#xa;def JPanel getAnonymousBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;            &#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the bookmark you want to link to this node.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To create a link to this node in a bookmarked node either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To create a link in a named bookmarked node press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the graphical user interface to display&#xd;&#xa;def createGui(&#xd;&#xa;    JPanel namedPanel, JList namedJList,&#xd;&#xa;    JPanel anonymPanel, JList anonymJList&#xd;&#xa;)&#xd;&#xa;{&#xd;&#xa;    def memorizedNodeID = ((MLinkController)(LinkController.getController())).getAnchorID()&#xd;&#xa;&#xd;&#xa;    def gui&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        gui = dialog(&#xd;&#xa;            title: &apos;Link this node in a bookmarked node&apos;,&#xd;&#xa;            modal:true,&#xd;&#xa;            owner: ui.frame,&#xd;&#xa;            defaultCloseOperation: JFrame.DISPOSE_ON_CLOSE&#xd;&#xa;        ){&#xd;&#xa;            borderLayout()&#xd;&#xa;            // A panel for all the compontents (needed to add an inner padding)&#xd;&#xa;            panel(&#xd;&#xa;                border: emptyBorder( 10 ),&#xd;&#xa;                constraints: BorderLayout.PAGE_START&#xd;&#xa;            ){&#xd;&#xa;                borderLayout()&#xd;&#xa;&#xd;&#xa;                // First element of the main panel :&#xd;&#xa;                // A panel which can contains 2 panels:&#xd;&#xa;                // - one for the named bookmarks&#xd;&#xa;                // - one for the anonymous bookmarks&#xd;&#xa;                panel( constraints: BorderLayout.LINE_START )&#xd;&#xa;                {&#xd;&#xa;                    borderLayout()&#xd;&#xa;                    if( namedPanel ) widget( namedPanel, constraints: BorderLayout.PAGE_START )&#xd;&#xa;                    if( anonymPanel ) widget( anonymPanel, constraints: BorderLayout.PAGE_END )&#xd;&#xa;                }&#xd;&#xa;&#xd;&#xa;                // Second element of the main panel :&#xd;&#xa;                vbox( constraints: BorderLayout.PAGE_END)&#xd;&#xa;                {&#xd;&#xa;                    if( memorizedNodeID ) label( text: &quot;&lt;html&gt;Press &lt;i&gt;Space&lt;/i&gt; to link the memorized node to this node.&lt;/html&gt;&quot; )&#xd;&#xa;                    label( text: &quot;&lt;html&gt;Press &lt;i&gt;Esc&lt;/i&gt; to cancel.&lt;/html&gt;&quot; )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Set Esc key to close the script&#xd;&#xa;    def onEscPressID = &quot;onEscPress&quot;&#xd;&#xa;    def inputMap = gui.getRootPane().getInputMap( JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT )&#xd;&#xa;    inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_ESCAPE, 0 ), onEscPressID )&#xd;&#xa;    gui.getRootPane().getActionMap().put(&#xd;&#xa;        onEscPressID,&#xd;&#xa;        new AbstractAction()&#xd;&#xa;        {&#xd;&#xa;&#x9;        @Override&#xd;&#xa;&#x9;        public void actionPerformed( ActionEvent e )&#xd;&#xa;            {&#xd;&#xa;&#x9;            gui.dispose()&#xd;&#xa;                c.statusInfo = &apos;Link creation aborded&apos;&#xd;&#xa;&#x9;        }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    if( memorizedNodeID )&#xd;&#xa;    { &#xd;&#xa;        // Set Space key to create the link to the standard freeplane memorized node&#xd;&#xa;        def onSpacePressID = &quot;onSpacePress&quot;&#xd;&#xa;        spaceStroke = KeyStroke.getKeyStroke( KeyEvent.VK_SPACE, 0 )&#xd;&#xa;        inputMap.put( spaceStroke, onSpacePressID )&#xd;&#xa;        gui.getRootPane().getActionMap().put(&#xd;&#xa;            onSpacePressID,&#xd;&#xa;            new AbstractAction()&#xd;&#xa;            {&#xd;&#xa;&#x9;            @Override&#xd;&#xa;&#x9;            public void actionPerformed( ActionEvent e )&#xd;&#xa;                {&#xd;&#xa;&#x9;                menuUtils.executeMenuItems( [ &apos;MakeLinkFromAnchorAction&apos; ] )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;&#x9;            }&#xd;&#xa;            }&#xd;&#xa;        )&#xd;&#xa;        if( namedJList ) namedJList.getInputMap().put( spaceStroke, &quot;none&quot; )&#xd;&#xa;        if( anonymJList ) anonymJList.getInputMap().put( spaceStroke, &quot;none&quot; )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    if( namedJList )&#xd;&#xa;        {&#xd;&#xa;        if( anonymPanel ) anonymPanel.visible = false&#xd;&#xa;        namedJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    else if( anonymJList )&#xd;&#xa;        {&#xd;&#xa;        if( namedPanel ) namedPanel.visible = false&#xd;&#xa;        anonymJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    // Set the Tab key to switch between the 2 bookmarks types&#xd;&#xa;    if( namedPanel &amp;&amp; namedJList &amp;&amp; anonymPanel &amp;&amp; anonymJList )&#xd;&#xa;        {&#xd;&#xa;        namedJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        anonymJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        def onTabPressID = &quot;onTabPress&quot;&#xd;&#xa;        inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_TAB, 0 ), onTabPressID )&#xd;&#xa;        gui.getRootPane().getActionMap().put(&#xd;&#xa;            onTabPressID,&#xd;&#xa;            new AbstractAction()&#xd;&#xa;            {&#xd;&#xa;                public void actionPerformed( ActionEvent e )&#xd;&#xa;                {&#xd;&#xa;                    if( namedPanel.visible )&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = false&#xd;&#xa;                        anonymPanel.visible = true&#xd;&#xa;                        anonymJList.requestFocus()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = true&#xd;&#xa;                        anonymPanel.visible = false&#xd;&#xa;                        namedJList.requestFocus()&#xd;&#xa;                    }                &#xd;&#xa;                    gui.pack()&#xd;&#xa;                    gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return gui&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Find all the bookmarks&#xd;&#xa;namedBookmarks = initNamedBookmarks( node.id )&#xd;&#xa;anonymousBookmarks = initAnonymousBookmarks( node.id )&#xd;&#xa;&#xd;&#xa;// Detect if the current node has a named bookmark&#xd;&#xa;isNamedBookmark = namedBookmarks.any{ it[ &quot;id&quot; ] == node.id }&#xd;&#xa;// Detect if the current node has a anonymous bookmark&#xd;&#xa;isAnonymousBookmark = node.icons.contains( anonymousIcon )&#xd;&#xa;&#xd;&#xa;// Quit the script if there is no bookmarks&#xd;&#xa;if( ! namedBookmarks &amp;&amp; ! anonymousBookmarks )&#xd;&#xa;    {&#xd;&#xa;    ui.informationMessage( ui.frame, &quot;There is no bookmarks !&quot;, &quot;Bookmarks&quot; )&#xd;&#xa;    return&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the gui&#xd;&#xa;JList namedBookmarksJList = getNamedBookmarksJList( namedBookmarks )&#xd;&#xa;JPanel namedBookmarksJPanel = getNamedBookmarksJPanel(&#xd;&#xa;    namedBookmarks, namedBookmarksJList, (boolean)anonymousBookmarks&#xd;&#xa;)&#xd;&#xa;JList anonymousBookmarksJList = getAnonymousBookmarksJList( anonymousBookmarks )&#xd;&#xa;JPanel anonymousBookmarksJPanel = getAnonymousBookmarksJPanel(&#xd;&#xa;    anonymousBookmarks, anonymousBookmarksJList, (boolean)namedBookmarks&#xd;&#xa;)&#xd;&#xa;gui = createGui(&#xd;&#xa;    namedBookmarksJPanel, namedBookmarksJList,&#xd;&#xa;    anonymousBookmarksJPanel, anonymousBookmarksJList&#xd;&#xa;)&#xd;&#xa;&#xd;&#xa;// Center the gui over the freeplane window&#xd;&#xa;gui.pack()&#xd;&#xa;gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;gui.visible = true&#xd;&#xa;" ID="ID_1965185987" CREATED="1562509032599" MODIFIED="1562509032601"/>
</node>
<node TEXT="CreateLinkToBookmark.groovy" FOLDED="true" ID="ID_1850367663" CREATED="1562412710763" MODIFIED="1562413615993">
<attribute_layout NAME_WIDTH="185.9999944567682 pt" VALUE_WIDTH="238.4999928921463 pt"/>
<attribute NAME="menuTitleKey" VALUE="addons.${name}.CreateLinkToBookmark"/>
<attribute NAME="menuLocation" VALUE="/menu_bar/${name}"/>
<attribute NAME="executionMode" VALUE="on_single_node"/>
<attribute NAME="keyboardShortcut" VALUE=""/>
<attribute NAME="execute_scripts_without_asking" VALUE="true"/>
<attribute NAME="execute_scripts_without_file_restriction" VALUE="true"/>
<attribute NAME="execute_scripts_without_write_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_exec_restriction" VALUE="false"/>
<attribute NAME="execute_scripts_without_network_restriction" VALUE="false"/>
<node TEXT="import groovy.json.JsonBuilder&#xd;&#xa;import groovy.json.JsonSlurper&#xd;&#xa;import groovy.swing.SwingBuilder&#xd;&#xa;import java.awt.BorderLayout&#xd;&#xa;import java.awt.Color&#xd;&#xa;import java.awt.Component&#xd;&#xa;import java.awt.FlowLayout&#xd;&#xa;import java.awt.GridBagConstraints&#xd;&#xa;import java.awt.Image&#xd;&#xa;import java.awt.KeyboardFocusManager&#xd;&#xa;import java.awt.event.*&#xd;&#xa;import javax.swing.AbstractAction&#xd;&#xa;import javax.swing.ActionMap&#xd;&#xa;import javax.swing.BoxLayout&#xd;&#xa;import javax.swing.ImageIcon&#xd;&#xa;import javax.swing.InputMap&#xd;&#xa;import javax.swing.JComponent&#xd;&#xa;import javax.swing.JFrame&#xd;&#xa;import javax.swing.JList&#xd;&#xa;import javax.swing.JPanel&#xd;&#xa;import javax.swing.KeyStroke&#xd;&#xa;import javax.swing.SwingConstants&#xd;&#xa;import javax.swing.UIManager&#xd;&#xa;import org.freeplane.plugin.script.proxy.Convertible&#xd;&#xa;import org.freeplane.features.link.LinkController&#xd;&#xa;import org.freeplane.features.link.mindmapmode.MLinkController&#xd;&#xa;&#xd;&#xa;storageKey = &quot;BookmarksKeys&quot;&#xd;&#xa;anonymousIcon = &quot;bookmarks/Bookmark 1&quot;&#xd;&#xa;namedIcon = &quot;bookmarks/Bookmark 2&quot;&#xd;&#xa;map = node.map&#xd;&#xa;namedBookmarks = []&#xd;&#xa;anonymousBookmarks = []&#xd;&#xa;&#xd;&#xa;gui = null&#xd;&#xa;&#xd;&#xa;def Map loadNamedBookmarks()&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap where :&#xd;&#xa;    // - the keys are the keyboard keys assigned to a bookmarked node;&#xd;&#xa;    // - the values are the id of the corresponding bookmarked node.&#xd;&#xa;    // This HashMap is read from the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    // Read the datas from the map storage&#xd;&#xa;    def marksString = new Convertible( &apos;{}&apos; )&#xd;&#xa;    def stored = node.map.storage.getAt( storageKey )&#xd;&#xa;    if( stored ) marksString = stored;&#xd;&#xa;&#xd;&#xa;    // Convert these datas to an HashMap&#xd;&#xa;    def namedBookmarksMap = new JsonSlurper().parseText( marksString.getText() )&#xd;&#xa;&#xd;&#xa;    return namedBookmarksMap as Map&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def saveNamedBookmarks( Map namedBookmarksMap )&#xd;&#xa;{&#xd;&#xa;    // Store the HashMap namedBookmarks in the freeplane map storage area.&#xd;&#xa;&#xd;&#xa;    def builder = new JsonBuilder()&#xd;&#xa;    builder( namedBookmarksMap )&#xd;&#xa;    node.map.storage.putAt( storageKey, builder.toString() )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def populateAnonymousBookmarksList( node, List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( node.icons.contains( anonymousIcon ) ){&#xd;&#xa;        def text = node.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        bookmarks &lt;&lt; [ &quot;id&quot;: node.id, &quot;text&quot;: text ]&#xd;&#xa;    }&#xd;&#xa;    node.children.each{ populateAnonymousBookmarksList( it, bookmarks ) }&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def putIconAtFirstPosition( node, icon )&#xd;&#xa;{&#xd;&#xa;    // Add an icon at the first position for this node&#xd;&#xa;    // Ensure this icon is unique&#xd;&#xa;&#xd;&#xa;    def icons = node.icons&#xd;&#xa;    &#xd;&#xa;    // Do nothing else if there is already this icon as fisrt icon&#xd;&#xa;    def num = icons.iterator().count( icon )&#xd;&#xa;    if( num == 1 &amp;&amp; icons.first == icon ) return&#xd;&#xa;&#xd;&#xa;    def oldIcons = icons.iterator().toList()&#xd;&#xa;&#xd;&#xa;    // Remove all the same icons if necessary&#xd;&#xa;    if( num &gt; 0 ) oldIcons.removeAll{ it == icon }&#xd;&#xa;&#xd;&#xa;    def newIcons = [ icon ]&#xd;&#xa;    newIcons.addAll( oldIcons )&#xd;&#xa;    icons.clear()&#xd;&#xa;    icons.addAll( newIcons )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def addNamedBookmarkIcon( node )&#xd;&#xa;{&#xd;&#xa;    // Add the named bookmark icon to this node, if needed.&#xd;&#xa;    // Remove anonymous bookmarks icons.&#xd;&#xa;    // Ensure the icon is the first icon of the node&#xd;&#xa;&#xd;&#xa;    def icons = node.getIcons()&#xd;&#xa;&#xd;&#xa;    // Remove anonymous bookmarks icons&#xd;&#xa;    while( icons.contains( anonymousIcon ) ) icons.remove( anonymousIcon )&#xd;&#xa;&#xd;&#xa;    putIconAtFirstPosition( node, namedIcon )&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a link to another node in a node&#xd;&#xa;def createLink( dst, src, message )&#xd;&#xa;{&#xd;&#xa;    dst.link.node = src&#xd;&#xa;    c.statusInfo = message&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the named bookmarks, except the current node if it is one of them&#xd;&#xa;def List initNamedBookmarks( currentNodeId )&#xd;&#xa;{&#xd;&#xa;    // Create a HashMap for the named bookmarks&#xd;&#xa;    def bmksMap = loadNamedBookmarks()&#xd;&#xa;&#xd;&#xa;    // Make sure namedBookmarks is up-to-date&#xd;&#xa;    def change = false&#xd;&#xa;    bmksMap.removeAll&#xd;&#xa;    {&#xd;&#xa;        // Remove from the map all the node that don&apos;t exist&#xd;&#xa;        // and add icon for each bookmarked node&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def n = map.node( id )&#xd;&#xa;        def missing = n == null&#xd;&#xa;        if( ! missing ) addNamedBookmarkIcon( n )&#xd;&#xa;        else {&#xd;&#xa;            change = true&#xd;&#xa;        }&#xd;&#xa;        missing&#xd;&#xa;    }&#xd;&#xa;    if( change ) saveNamedBookmarks( bmksMap )&#xd;&#xa;&#xd;&#xa;    // If the currentNode is a named bookmark, remove it&#xd;&#xa;    bmksMap.removeAll{ key, id -&gt; id == currentNodeId }&#xd;&#xa;    &#xd;&#xa;    // Refactor the map to make a list, better suited for the rest of the script&#xd;&#xa;    def bmksList = bmksMap.collect{&#xd;&#xa;        key, id -&gt;&#xd;&#xa;        def target = map.node( id )&#xd;&#xa;        def text = target.text&#xd;&#xa;        if( text.length() &gt; 30 ) text = text[0..27] + &quot;...&quot;&#xd;&#xa;        [&#xd;&#xa;            &quot;id&quot;: id,&#xd;&#xa;            &quot;name&quot;: String.valueOf( (char) Integer.parseInt( key ) ),&#xd;&#xa;            &quot;text&quot;: text&#xd;&#xa;        ]&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return bmksList&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a list of all the anonymous bookmarks, except from the current node if it is one of them&#xd;&#xa;def List initAnonymousBookmarks( currentNodeId )&#xd;&#xa;{&#xd;&#xa;    def bookmarks = []&#xd;&#xa;    populateAnonymousBookmarksList( map.root, bookmarks )&#xd;&#xa;    // Remove the currentNode&#xd;&#xa;    bookmarks.removeAll{ it.id == currentNodeId }&#xd;&#xa;    return bookmarks&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getNamedBookmarksJList( List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{&#xd;&#xa;                // Display for each bookmark the name of the bookmark,&#xd;&#xa;                // followed by the text of the node&#xd;&#xa;                &quot;&lt;html&gt;&lt;font color=&apos;red&apos;&gt;&lt;b&gt;&lt;i&gt;$it.name&lt;/i&gt;&lt;/b&gt;&lt;/font&gt; : $it.text&lt;/html&gt;&quot;&#xd;&#xa;            },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() ),&#xd;&#xa;            border: emptyBorder( 5 )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;    component.setSelectedIndex( 0 )&#xd;&#xa;    &#xd;&#xa;    // Set the user interactions&#xd;&#xa;    &#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            public void keyReleased( KeyEvent e )&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                char chr = e.getKeyChar()&#xd;&#xa;                int idx = (int) chr&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int i = component.getSelectedIndex()&#xd;&#xa;                    if( i &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ i ]&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link to bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;                else if( idx &gt; 32 &amp;&amp; idx != 127 &amp;&amp; idx &lt; 256 ){&#xd;&#xa;                    // Try to link to the corresponding node id&#xd;&#xa;                    String s = String.valueOf( chr )&#xd;&#xa;                    def bm = bookmarks.find{ it.name == s }&#xd;&#xa;                    if( bm )&#xd;&#xa;                        {&#xd;&#xa;                        def target = map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link to bookmark named \&quot;${s}\&quot;&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        c.statusInfo = &apos;There is no node marked with the key &apos; + chr&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    createLink( node, target, &quot;Created link to bookmark named \&quot;$bm.name\&quot;&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;    &#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the named bookmarks&#xd;&#xa;def JPanel getNamedBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;&#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the named bookmark you want to link.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To create a link to a named bookmark either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Press one of the red keys&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To create a link to a standard bookmark press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;&#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;def JList getAnonymousBookmarksJList( List bookmarks )&#xd;&#xa;{&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;&#xd;&#xa;    // Create the component&#xd;&#xa;    JList component&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        component = list(&#xd;&#xa;            items: bookmarks.collect{ it.text },&#xd;&#xa;            visibleRowCount: Integer.min( 20, bookmarks.size() )&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;    component.setSelectedIndex( 0 )&#xd;&#xa;&#xd;&#xa;    // Set the user interactions&#xd;&#xa;    component.addKeyListener(&#xd;&#xa;        new KeyAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void keyReleased(KeyEvent e)&#xd;&#xa;            {&#xd;&#xa;                int code = e.getKeyCode()&#xd;&#xa;                if( code == KeyEvent.VK_ENTER ){&#xd;&#xa;                    int idx = component.getSelectedIndex()&#xd;&#xa;                    if( idx &gt;= 0 )&#xd;&#xa;                        {&#xd;&#xa;                        def bm = bookmarks[ idx ]&#xd;&#xa;                        def target = node.map.node( bm.id )&#xd;&#xa;                        createLink( node, target, &quot;Created link to bookmark&quot; )&#xd;&#xa;                        gui.dispose()&#xd;&#xa;                    }&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;        &#xd;&#xa;    component.addMouseListener(&#xd;&#xa;        new MouseAdapter()&#xd;&#xa;        {&#xd;&#xa;            @Override public void mouseClicked(MouseEvent e)&#xd;&#xa;            {&#xd;&#xa;                int idx = component.getSelectedIndex()&#xd;&#xa;                if( idx &gt;= 0 )&#xd;&#xa;                    {&#xd;&#xa;                    def bm = bookmarks[ idx ]&#xd;&#xa;                    def target = node.map.node( bm.id )&#xd;&#xa;                    createLink( node, target, &quot;Created link to bookmark&quot; )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    return component&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create a JPanel for the anonymous bookmarks&#xd;&#xa;def JPanel getAnonymousBookmarksJPanel(&#xd;&#xa;    List bookmarks,         // List of the bookmarks&#xd;&#xa;    JList bookmarksJList,   // Component that display this list&#xd;&#xa;    boolean showTabTip      // Do we need to add a comment about the Tab key ?&#xd;&#xa;){&#xd;&#xa;    if( ! bookmarks ) return null&#xd;&#xa;    &#xd;&#xa;    // List all the named bookmarks&#xd;&#xa;    JPanel jPane&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        jPane = panel(&#xd;&#xa;            border: emptyBorder( [0,0,10,0] )&#xd;&#xa;        )&#xd;&#xa;        {&#xd;&#xa;            gridBagLayout()&#xd;&#xa;            // This gridbag will contains 4 items&#xd;&#xa;            // Row 0 : A label and a question mark label with a tooltip&#xd;&#xa;            // Row 1 : A label&#xd;&#xa;            // Row 2 : The kist of the named bookmarks&#xd;&#xa;            &#xd;&#xa;            // Row 0&#xd;&#xa;            label(&#xd;&#xa;                &quot;Select the bookmark you want to link.&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:0, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            def icon = UIManager.getIcon(&quot;OptionPane.questionIcon&quot;)&#xd;&#xa;            Image img = icon.getImage()&#xd;&#xa;            int w = icon.getIconWidth() / 2&#xd;&#xa;            int h = icon.getIconHeight() / 2&#xd;&#xa;            def newimg = img.getScaledInstance( w, h, Image.SCALE_SMOOTH )&#xd;&#xa;            icon = new ImageIcon( newimg )&#xd;&#xa;            label(&#xd;&#xa;                icon: icon,&#xd;&#xa;                toolTipText:&#xd;&#xa;                    &quot;&quot;&quot;&lt;html&gt;&#xd;&#xa;                        To create a link to a bookmark either:&#xd;&#xa;                        &lt;ul&gt;&#xd;&#xa;                            &lt;li&gt;Click a bookmark&lt;/li&gt;&#xd;&#xa;                            &lt;li&gt;Select a bookmark with the &lt;i&gt;arrow keys&lt;/i&gt; and press &lt;i&gt;Enter&lt;/i&gt;&lt;/li&gt;&#xd;&#xa;                        &lt;/ul&gt;&#xd;&#xa;                    &lt;/html&gt;&quot;&quot;&quot;,&#xd;&#xa;                constraints: gbc( gridx:1, gridy:0, anchor:GridBagConstraints.LINE_START, weightx:1, insets:[0,10,0,0] )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 1&#xd;&#xa;            if( showTabTip ) label(&#xd;&#xa;                &quot;&lt;html&gt;To create a link to a named bookmark press &lt;i&gt;Tab&lt;/i&gt;.&lt;/html&gt;&quot;,&#xd;&#xa;                constraints: gbc( gridx:0, gridy:1, gridwidth:2, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            &#xd;&#xa;            // Row 2&#xd;&#xa;            scrollPane(&#xd;&#xa;                border: emptyBorder( [10,0,0,0] ),&#xd;&#xa;                constraints: gbc( gridx:0, gridy:2, gridwidth:2, fill:GridBagConstraints.HORIZONTAL, anchor:GridBagConstraints.LINE_START )&#xd;&#xa;            )&#xd;&#xa;            {&#xd;&#xa;                widget( bookmarksJList )&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return jPane&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the graphical user interface to display&#xd;&#xa;def createGui(&#xd;&#xa;    JPanel namedPanel, JList namedJList,&#xd;&#xa;    JPanel anonymPanel, JList anonymJList&#xd;&#xa;)&#xd;&#xa;{&#xd;&#xa;    def memorizedNodeID = ((MLinkController)(LinkController.getController())).getAnchorID()&#xd;&#xa;&#xd;&#xa;    def gui&#xd;&#xa;    SwingBuilder.build{&#xd;&#xa;        gui = dialog(&#xd;&#xa;            title: &apos;Create a link to a bookmark&apos;,&#xd;&#xa;            modal:true,&#xd;&#xa;            owner: ui.frame,&#xd;&#xa;            defaultCloseOperation: JFrame.DISPOSE_ON_CLOSE&#xd;&#xa;        ){&#xd;&#xa;            borderLayout()&#xd;&#xa;            // A panel for all the compontents (needed to add an inner padding)&#xd;&#xa;            panel(&#xd;&#xa;                border: emptyBorder( 10 ),&#xd;&#xa;                constraints: BorderLayout.PAGE_START&#xd;&#xa;            ){&#xd;&#xa;                borderLayout()&#xd;&#xa;&#xd;&#xa;                // First element of the main panel :&#xd;&#xa;                // A panel which can contains 2 panels:&#xd;&#xa;                // - one for the named bookmarks&#xd;&#xa;                // - one for the anonymous bookmarks&#xd;&#xa;                panel( constraints: BorderLayout.LINE_START )&#xd;&#xa;                {&#xd;&#xa;                    borderLayout()&#xd;&#xa;                    if( namedPanel ) widget( namedPanel, constraints: BorderLayout.PAGE_START )&#xd;&#xa;                    if( anonymPanel ) widget( anonymPanel, constraints: BorderLayout.PAGE_END )&#xd;&#xa;                }&#xd;&#xa;&#xd;&#xa;                // Second element of the main panel :&#xd;&#xa;                vbox( constraints: BorderLayout.PAGE_END)&#xd;&#xa;                {&#xd;&#xa;                    if( memorizedNodeID ) label( text: &quot;&lt;html&gt;Press &lt;i&gt;Space&lt;/i&gt; to link to memorized node.&lt;/html&gt;&quot; )&#xd;&#xa;                    label( text: &quot;&lt;html&gt;Press &lt;i&gt;Esc&lt;/i&gt; to cancel.&lt;/html&gt;&quot; )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        }&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    // Set Esc key to close the script&#xd;&#xa;    def onEscPressID = &quot;onEscPress&quot;&#xd;&#xa;    def inputMap = gui.getRootPane().getInputMap( JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT )&#xd;&#xa;    inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_ESCAPE, 0 ), onEscPressID )&#xd;&#xa;    gui.getRootPane().getActionMap().put(&#xd;&#xa;        onEscPressID,&#xd;&#xa;        new AbstractAction()&#xd;&#xa;        {&#xd;&#xa;&#x9;        @Override&#xd;&#xa;&#x9;        public void actionPerformed( ActionEvent e )&#xd;&#xa;            {&#xd;&#xa;&#x9;            gui.dispose()&#xd;&#xa;                c.statusInfo = &apos;Link creation aborded&apos;&#xd;&#xa;&#x9;        }&#xd;&#xa;        }&#xd;&#xa;    )&#xd;&#xa;&#xd;&#xa;    if( memorizedNodeID )&#xd;&#xa;    { &#xd;&#xa;        // Set Space key to create the link to the standard freeplane memorized node&#xd;&#xa;        def onSpacePressID = &quot;onSpacePress&quot;&#xd;&#xa;        spaceStroke = KeyStroke.getKeyStroke( KeyEvent.VK_SPACE, 0 )&#xd;&#xa;        inputMap.put( spaceStroke, onSpacePressID )&#xd;&#xa;        gui.getRootPane().getActionMap().put(&#xd;&#xa;            onSpacePressID,&#xd;&#xa;            new AbstractAction()&#xd;&#xa;            {&#xd;&#xa;&#x9;            @Override&#xd;&#xa;&#x9;            public void actionPerformed( ActionEvent e )&#xd;&#xa;                {&#xd;&#xa;&#x9;                menuUtils.executeMenuItems( [ &apos;MakeLinkToAnchorAction&apos; ] )&#xd;&#xa;                    gui.dispose()&#xd;&#xa;&#x9;            }&#xd;&#xa;            }&#xd;&#xa;        )&#xd;&#xa;        if( namedJList ) namedJList.getInputMap().put( spaceStroke, &quot;none&quot; )&#xd;&#xa;        if( anonymJList ) anonymJList.getInputMap().put( spaceStroke, &quot;none&quot; )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    if( namedJList )&#xd;&#xa;        {&#xd;&#xa;        if( anonymPanel ) anonymPanel.visible = false&#xd;&#xa;        namedJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    else if( anonymJList )&#xd;&#xa;        {&#xd;&#xa;        if( namedPanel ) namedPanel.visible = false&#xd;&#xa;        anonymJList.requestFocus()&#xd;&#xa;    }&#xd;&#xa;    &#xd;&#xa;    // Set the Tab key to switch between the 2 bookmarks types&#xd;&#xa;    if( namedPanel &amp;&amp; namedJList &amp;&amp; anonymPanel &amp;&amp; anonymJList )&#xd;&#xa;        {&#xd;&#xa;        namedJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        anonymJList.setFocusTraversalKeysEnabled( false )&#xd;&#xa;        def onTabPressID = &quot;onTabPress&quot;&#xd;&#xa;        inputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_TAB, 0 ), onTabPressID )&#xd;&#xa;        gui.getRootPane().getActionMap().put(&#xd;&#xa;            onTabPressID,&#xd;&#xa;            new AbstractAction()&#xd;&#xa;            {&#xd;&#xa;                public void actionPerformed( ActionEvent e )&#xd;&#xa;                {&#xd;&#xa;                    if( namedPanel.visible )&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = false&#xd;&#xa;                        anonymPanel.visible = true&#xd;&#xa;                        anonymJList.requestFocus()&#xd;&#xa;                    }&#xd;&#xa;                    else&#xd;&#xa;                        {&#xd;&#xa;                        namedPanel.visible = true&#xd;&#xa;                        anonymPanel.visible = false&#xd;&#xa;                        namedJList.requestFocus()&#xd;&#xa;                    }                &#xd;&#xa;                    gui.pack()&#xd;&#xa;                    gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        )&#xd;&#xa;    }&#xd;&#xa;&#xd;&#xa;    return gui&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Find all the bookmarks&#xd;&#xa;namedBookmarks = initNamedBookmarks( node.id )&#xd;&#xa;anonymousBookmarks = initAnonymousBookmarks( node.id )&#xd;&#xa;&#xd;&#xa;// Detect if the current node has a named bookmark&#xd;&#xa;isNamedBookmark = namedBookmarks.any{ it[ &quot;id&quot; ] == node.id }&#xd;&#xa;// Detect if the current node has a anonymous bookmark&#xd;&#xa;isAnonymousBookmark = node.icons.contains( anonymousIcon )&#xd;&#xa;&#xd;&#xa;// Quit the script if there is no bookmarks&#xd;&#xa;if( ! namedBookmarks &amp;&amp; ! anonymousBookmarks )&#xd;&#xa;    {&#xd;&#xa;    ui.informationMessage( ui.frame, &quot;There is no bookmarks !&quot;, &quot;Bookmarks&quot; )&#xd;&#xa;    return&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;// Create the gui&#xd;&#xa;JList namedBookmarksJList = getNamedBookmarksJList( namedBookmarks )&#xd;&#xa;JPanel namedBookmarksJPanel = getNamedBookmarksJPanel(&#xd;&#xa;    namedBookmarks, namedBookmarksJList, (boolean)anonymousBookmarks&#xd;&#xa;)&#xd;&#xa;JList anonymousBookmarksJList = getAnonymousBookmarksJList( anonymousBookmarks )&#xd;&#xa;JPanel anonymousBookmarksJPanel = getAnonymousBookmarksJPanel(&#xd;&#xa;    anonymousBookmarks, anonymousBookmarksJList, (boolean)namedBookmarks&#xd;&#xa;)&#xd;&#xa;gui = createGui(&#xd;&#xa;    namedBookmarksJPanel, namedBookmarksJList,&#xd;&#xa;    anonymousBookmarksJPanel, anonymousBookmarksJList&#xd;&#xa;)&#xd;&#xa;&#xd;&#xa;// Center the gui over the freeplane window&#xd;&#xa;gui.pack()&#xd;&#xa;gui.setLocationRelativeTo( ui.frame )&#xd;&#xa;gui.visible = true&#xd;&#xa;&#xd;&#xa;" ID="ID_941689057" CREATED="1562509032601" MODIFIED="1562509032603"/>
</node>
</node>
<node TEXT="lib" POSITION="right" ID="ID_1159449610" CREATED="1562410359919" MODIFIED="1562499736338">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      An add-on may contain any number of nodes containing binary files (normally .jar files) to be added to the add-on's classpath.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The immediate child nodes contain the name of the file, e.g. 'mysql-connector-java-5.1.25.jar'). Put the file into a 'lib' subdirectory of the add-on base directory.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The child nodes of these nodes contain the actual files.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- Any lib file will be extracted in &lt;installationbase&gt;/&lt;addonname&gt;/lib.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The files will be processed in the sequence as seen in the map.
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="zips" POSITION="right" ID="ID_435012533" CREATED="1562410359928" MODIFIED="1562499736343">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      An add-on may contain any number of nodes containing zip files.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The immediate child nodes contain a description of the zip. The devtools script releaseAddOn.groovy allows automatic zip creation if the name of this node matches a directory in the current directory.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The child nodes of these nodes contain the actual zip files.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- Any zip file will be extracted in the &lt;installationbase&gt;. Currently, &lt;installationbase&gt; is always Freeplane's &lt;userhome&gt;, e.g. ~/.freeplane/1.3.
    </p>
    <p>
      
    </p>
    <p>
      &#160;- The files will be processed in the sequence as seen in the map.
    </p>
  </body>
</html>
</richcontent>
<node TEXT="icons" FOLDED="true" ID="ID_1144883898" CREATED="1562410359939" MODIFIED="1562410359940">
<node TEXT="UEsDBBQACAgIALVs504AAAAAAAAAAAAAAAAQAAAAaWNvbnMvYm9va21hcmtzLwMAUEsHCAAAAA&#xa;ACAAAAAAAAAFBLAwQUAAgICABol+ZOAAAAAAAAAAAAAAAAHgAAAGljb25zL2Jvb2ttYXJrcy9C&#xa;b29rbWFyayAxLnN2Z52UW2/TMBTHn9tPYbwXJsWOb3Gcsg7RNrtIBSbtgniautZLI0xSkrTd+P&#xa;QcJx3aRnmAFzvn2Pn9T84lR+8fvju0sVWdl8UQc8owssW8XORFNsTr5p4Y/P64f/SGEHRqC1vN&#xa;mrIaoA+L8s6ic+fWddO6EI8ooyxAlzenKH1YlVWDLtw6I+cFoq3zptMYIE0ZQ6N17haIHSJEiM&#xa;dPPo+vvl6kqN5k6OJ6ND0fI0zC8Isch+HkatISOOVhmH7CCC+bZjUIw+12S7eSllUWnlaz1TKf&#xa;1yFcDP1FeCkEGOd00SwwSHjys+/kGOWLIR7P3I+1vQUL8lDUwz1owRjzqN2VwYPLi2/7LvIkSc&#xa;L2FK4OMVs9YPTY7f0e2uaLZgnKLKJSKn+2tHm2bMAVS6p17F2b3G5HpX8ZMbS7inbnvjCzO2fJ&#xa;3Wz+LavKdQHxF3aL9t0FQYh2UK9mczvEq8rWttpYn4fVrFmiEvx544OjEiPgfOQMymdMwGPhAY&#xa;4oQ5lSRCsqo2iqng5upPFCc0YED3hEpA6khnUp1FyIgIEFblhbmtQ3u/d+4hDEs+N+r4vgPndu&#xa;iA/SsebJSRdCpxgkEU2UmXqMoMIr6jEYXvb35kWDVhMcgnGvC/FzEUDBY6Nby+vDJqIN55oKJf&#xa;q93vSFSBtU7whKZmcVtNAit0XT9gW00fnklt9ilO3c10XeQH+sIZGXPqufi+vaQqH5ELdMGUG1&#xa;wYhpwqSBA/H8AAwdUyFFDDXo9Y7qplwhVN7f1xY6AIaubh4dVMr7ybx0MGQHaZxORvG71rUr2I&#xa;DRKGmD/gNBZazMfk6UjkbqNUdq8zdSzFS0lzQ5Sc2H0WsSj5XaS+L7ITqVyfgVpCtE+LISv5vl&#xa;ebtCZF3vrCv39uCpTof/30IQ9z910d4Wet7TSvKRmHQBaRZwMecKcAnghQJ8HCSgplsD6H4TZp&#xa;MYSCR3RGiqhCEyosqRhGquCRfUGL6zgs6a+iilovDTgQ+AD4SJ5O2sAl2riAgFZFjPNEM+DHYG&#xa;SYDJhKeg3aTeeICU0r2Y9Z0VdJZPXdKOtPHT7UFTv3TzHGZ+gZ/jcf8XUEsHCCvEi1UmAwAASg&#xa;YAAFBLAwQUAAgICABol+ZOAAAAAAAAAAAAAAAAHgAAAGljb25zL2Jvb2ttYXJrcy9Cb29rbWFy&#xa;ayAyLnN2Z52U227bOBCGr+2nYJmbBhApnkRR3ihFfUgawNsGaJLFXgWKTMtCFcmV5EP79DuUnD&#xa;ZJXSx2dUFqZshvhuRPnr3bPxZoa+smr8oYc8owsmVaLfIyi/GmXRKD350Pz94Qgi5taeukreoR&#xa;er+oHiy6KopN03YuxAPKKPPQ57tLNNuvq7pF18UmI1clop3zrs8xQpoyhsabvFggdooQIQ4//T&#xa;S5+ft6hppthq5vx/OrCcLE9/+SE9+f3kw7Aqfc92cfMcKrtl2PfH+329GdpFWd+Zd1sl7laePD&#xa;QN8NhEk+wDini3aBIYUjP1snxyhfxHiSFF839h4s2IeyiY+gBWPMoQ5DRvsiL78cG8ijKPK7KA&#xa;yNMVvvMfrW98MB2uWLdgWZWUClVC62snm2asEVSqp16Fzb3O7GlZuMGDoMRYe4O5jkobDkIUm/&#xa;ZHW1KaH+0u7QsbGQEKodNesktTFe17ax9da6fVgn7QpV4M9bVxyVv+XChxH8/8kZHK0xHg+Fgx&#xa;dEGcqUIlpRGQRz9RS4k8YVkTIiuMcDIrUnNbQroYaDVAiPgQ0BaDue1HeHmd+xD6Vl58NBX98y&#xa;L4oYnzA2CaOLvog+pxcFNFLR3GEEFS6nnoDhEv/oXFrPZU3BIRh3eWEFXHogh9DoznL5oRPBln&#xa;NNhRLDwWD+IklX1ADcZ3CmNqlBY4vclm0nHNDZ1fSe32OUHdy3Zd6CgDaw05/dtn8qbxsLSuAx&#xa;hkUyJSOQAxhEQ75AGwMx8TwmXCwMqImM+om9qZOyWVb1Y4wfk7bO9295d+KEIyIUIpoZ2EF9Cm&#xa;cLlTZttUaoWi4bC8qCy9y03wpQgPOTtCrg8p7Mwtl0HP7RuQ5CGDEaRN1yf0FQGSpznBPMxmP1&#xa;miO1+R0pZCo4SppezMz78WsSD5U6SuLHIXomo8krSDf/zH95gD9k9uwahFBZr7pNXbw9eTre03&#xa;+/Hf9HmLCm/6TNY8J8dVOCSIm+IM08LlKuABcBXijAh14E2XRnAN11wjxRDVBFQSIKyoSp1IRm&#xa;zoXHpaLwpsFCXLmM8O66A0irAKQHEGg/aIZcRvYB1gtXG/68rpN66wBSyuLFc3GwvN5yuxR1b4&#xa;Jxz4MDzV3TPwh+5hp4e8+H/wBQSwcIVRNuT0wDAACpBgAAUEsBAhQAFAAICAgAtWznTgAAAAAC&#xa;AAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAGljb25zL2Jvb2ttYXJrcy9QSwECFAAUAAgICABol+&#xa;ZOK8SLVSYDAABKBgAAHgAAAAAAAAAAAAAAAABAAAAAaWNvbnMvYm9va21hcmtzL0Jvb2ttYXJr&#xa;IDEuc3ZnUEsBAhQAFAAICAgAaJfmTlUTbk9MAwAAqQYAAB4AAAAAAAAAAAAAAAAAsgMAAGljb2&#xa;5zL2Jvb2ttYXJrcy9Cb29rbWFyayAyLnN2Z1BLBQYAAAAAAwADANYAAABKBwAAAAA=" ID="ID_1955603289" CREATED="1562509032607" MODIFIED="1562509032653"/>
</node>
<node TEXT="scripts" FOLDED="true" ID="ID_87188883" CREATED="1562410359941" MODIFIED="1562410359942">
<node TEXT="UEsDBBQACAgIAG91504AAAAAAAAAAAAAAAANAAAAc2NyaXB0cy9pbml0LwMAUEsHCAAAAAACAA&#xa;AAAAAAAFBLAwQUAAgICABvdedOAAAAAAAAAAAAAAAAKQAAAHNjcmlwdHMvaW5pdC9Cb29rbWFy&#xa;a3NNb25pdG9ySWNvbnMuZ3Jvb3Z5zVltUxs3EP5sZvgPKh+S88SIph/bkhmgZMq0QCck7ceMfC&#xa;fbCmfdRdIZaIb/3l293TuYpmSaTMC+213tPrvafaSIdVkoQwq1pAvFeZkzyemCM1MprumalfTs&#xa;osj4yYrJJf9daMMlV7s74lG1Wut0w6XZRuXsnJX/bqFz+Jc/KgxC9KSQRhV5/rhtkRaSLlhqCn&#xa;VHz+DLFXzib92DrZSj0lbS50JmqDEiXObVUkiqUyVKQ0tV3N5hMBuujJjnY0sMaV3ZLx+MyHXU&#xa;+sQ2jILGkl4ZJeTyuBJ51sDIvq9AhZ7Kas0VMwI93d1Jc6Y1aWeNgFLO15B1TQaqZ0aGEv1ld2&#xa;fi1iaSrbmFghySvXlRXK+ZutYHx/4T+WGvlmWykHfrotIPyL9uyGvIB1vy3/gdCgcRDd/1HsYz&#xa;Kat5LlKyKURGZPQ9Szr1TDj+nIICOj45OCB/rbgEdwgmkwhNWJbxDNJBFF8XG/i4KNSaMGt0Rm&#xa;44WVfaEMOuuTeQMsUJmxcVPF1xEgOxFjX50Yvtk6P4zi1mDc05qaT4XHEipF9lVAG8wxUWQoGi&#xa;fVIs+jo2DfttzRQChJU0h0KT+R3G5BXJzUqkKzDtLRCIe8EVlymEbgrUYh2TPGsveWbQMzA5F4&#xa;CdRC2H3aAr9dJxxeDCE5ZG3cv5J54aArujhN2EhWGTS8MDlIldxgUbRGoj4MCRT/6KaVgTqyGU&#xa;AOhxwzOUEwuSRGP04vKX049nJ5cXlH+uWK6TsOZ0+sXZHTTcsAcGE+9MkWd/shwqYGprchJqHp&#xa;773dGWo4iJk0QjUeywsQODKXTjD2X13dtOSTmYY6mrYt0R84jrWW2PycwWE/RAImzumWkUZllo&#xa;4drMJLgoNEL3K9MXaDvs3sTlZAp/y8p8sLsAnT/Sb9EQfkz8tmsE5sze21/3D2Btk9hBWvKbGu&#xa;ndHdL5E/oYv2nhHrQ87l0tNB9VxnJwtgCEACkEaygRPhAre+yxHRQchZtQSp8VcnQN1rDpNyvw&#xa;Ydw/t3+w0UB9DdeTt8lzHcpvdHGfcWJlO2i358go4oovq5ypEcy3wStYbm6oQat+S8EcTy0ID8&#xa;c/6cfeCamxbigMTP4I9CXwEnTtoR05eXrqPfhfRpx5mhszW0Ju6m3r0jAo951m4H7c9whBITG5&#xa;Z1JDiwZOQOqpUMLwlmbWeJKugELNYBobW2cy47ekzxdcXWB5eaNtatAkBQLoVHuKeUsI1gxqJW&#xa;WVtp3UT2lG0qK8s7NdFgCfcot1JyH1Zo4rP9QLyZ2kt9MbnTfCrMC6hiaXc3LN7+YFUxl+mNVt&#xa;DSzqIgbjB3msuO4wx4GBL9Fj6jZUpM9WxH06JF0mTnF6frx6f/nuFJUCi3ZmD2tVuuQmvEz6fS&#xa;HjCwKnCdBo0GM73pMpHjNQpkWN/cY5xOSS1ptkGgwi2bQyeE7xzBP9ODJJk4hOHS9Igvz0Adte&#xa;Bq24F8k0hFBWasmPFZPp6i3AecyyixClTmI52lpx9qexxiFX7zicRaDpKGSQi0ZhNrgUC0NngM&#xa;KVSmyYsVs450iDR/pgh0jFHbF9AlDsyqGHHH7vq9Fu2evj+xMqKAdPLUoBSMMEQvty7yV5ZcOh&#xa;0CNe2e8tbI+yLJ4Mhmcuklk7ZTyaoHQqfVsUOrbD2OsC2rYrjfe8NtizQEzQHKaljb47Zhz6QP&#xa;CLRQr6l/AbSVMt/oZ8AFd/je+Ab+ccRh55Q74Pk21oA2qEE+WmkUfZIy+WEg7f2h+3eHOWRaX9&#xa;fd+XQ/5aHqEHL140VwOPhhZwifyvOsz7AnM72mZaQE9sbMBp6ndWfYau/i/LpZ3L5y2Wh0qllU&#xa;f35TkrJawQSmUoc72kvXMDLuQtDrROe7QZaHr9zbbo4bfco9vh4ggc1LblKvZyxR2VngJYK5hZ&#xa;nD9o1d3UbIFgUHI+4IZewGGcfy24T61pT4tH8Z3U/uGcrtlqE3lrPwhCoTeAcPYHb7I82ei8S2&#xa;qHGtS2vrWIfKLK85n1aVZ75ny2waAPtenMH6NdVEPVMnYwsXc+eR4LCGmza3lzy3ucEXcNhMQZ&#xa;aG+HvwwcnzrN8SES9UjtDRHEWH0NYhTYHf6mAk8Gl4sRGmFLK2T1u6jsU9lGzA2MsKPwiYM5sR&#xa;dpCzhKrezTjeA3Ljn9Q6MLxLLAmJ1J48735wjBG0cpAdqwncJ3R4D95ggP6YrpcxiQp/5mOIln&#xa;4S14K+pLfmu8cjLtE9m6juyPgwP8hzcIQ1fQ7r2nnCfxvwQgkPoLTSuFZzoMtvG0pbC70/pKZW&#xa;8lDbUvsyOoWQxWGGwFJ3hnntQzp61B7ZW6vyO6p5xBLaNueyWXuX5kicBL6fuuY+vuhfvz+tW7&#xa;3x9xC9IzEILtRJ1n9pTTU+6vM6r7D1BLBwhlkXLV8QYAAOkaAABQSwECFAAUAAgICABvdedOAA&#xa;AAAAIAAAAAAAAADQAAAAAAAAAAAAAAAAAAAAAAc2NyaXB0cy9pbml0L1BLAQIUABQACAgIAG91&#xa;505lkXLV8QYAAOkaAAApAAAAAAAAAAAAAAAAAD0AAABzY3JpcHRzL2luaXQvQm9va21hcmtzTW&#xa;9uaXRvckljb25zLmdyb292eVBLBQYAAAAAAgACAJIAAACFBwAAAAA=" ID="ID_894393439" CREATED="1562509032654" MODIFIED="1562509032658"/>
</node>
</node>
<node TEXT="images" POSITION="right" ID="ID_63266556" CREATED="1562410359950" MODIFIED="1562499736369" TEXT_SHORTENED="true">
<edge COLOR="#353535"/>
<richcontent TYPE="NOTE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      An add-on may define any number of images as child nodes of the images node. The actual image data has to be placed as base64 encoded binary data into the text of a subnode.
    </p>
    <p>
      The images are saved to the <i>${installationbase}/resources/images</i>&#160;directory.
    </p>
    <p>
      
    </p>
    <p>
      The following images should be present:
    </p>
    <ul>
      <li>
        <i>${name}-icon.png</i>, like <i>oldicons-theme-icon.png</i>. This will be used in the app-on overview.
      </li>
      <li>
        <i>${name}-screenshot-1.png</i>, like <i>oldicons-theme-screenshot-1.png</i>. This will be used in the app-on details dialog. Further images can be included but they are not used yet.
      </li>
    </ul>
    <p>
      Images can be added automatically by releaseAddOn.groovy or must be uploaded into the map via the script <i>Tools-&gt;Scripts-&gt;Insert Binary</i>&#160;since they have to be (base64) encoded as simple strings.
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</map>
